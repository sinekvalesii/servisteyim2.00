<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Servisteyim 2.0 - Ä°ÅŸ OdaklÄ± Dijital Pazaryeri</title>
    
    <!-- React Core -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            DEFAULT: '#4F46E5',
                            dark: '#4338ca',
                            light: '#818cf8'
                        },
                        gold: {
                            DEFAULT: '#FFD700',
                            dark: '#FFA500'
                        },
                        chat: {
                            sent: '#dcf8c6', 
                            received: '#ffffff',
                            bg: '#f9fafb' 
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Icons (Lucide React alternative for CDN usage - Feathers) -->
    <script src="https://unpkg.com/feather-icons"></script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .chat-area {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 h-screen overflow-hidden flex flex-col font-sans">

    <div id="root" class="flex-1 h-full flex flex-col relative overflow-hidden"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useContext, createContext, useRef } = React;

        // --- DATA: TURKEY CITIES & DISTRICTS ---
        const TURKEY_DATA = {
            "Adana": ["AladaÄŸ", "Ceyhan", "Ã‡ukurova", "Feke", "Ä°mamoÄŸlu", "KaraisalÄ±", "KarataÅŸ", "Kozan", "PozantÄ±", "Saimbeyli", "SarÄ±Ã§am", "Seyhan", "Tufanbeyli", "YumurtalÄ±k", "YÃ¼reÄŸir"],
            "AdÄ±yaman": ["Besni", "Ã‡elikhan", "Gerger", "GÃ¶lbaÅŸÄ±", "Kahta", "Merkez", "Samsat", "Sincik", "Tut"],
            "Afyonkarahisar": ["BaÅŸmakÃ§Ä±", "Bayat", "Bolvadin", "Ã‡ay", "Ã‡obanlar", "DazkÄ±rÄ±", "Dinar", "EmirdaÄŸ", "Evciler", "Hocalar", "Ä°hsaniye", "Ä°scehisar", "KÄ±zÄ±lÃ¶ren", "Merkez", "SandÄ±klÄ±", "SinanpaÅŸa", "SultandaÄŸÄ±", "Åžuhut"],
            "AÄŸrÄ±": ["Diyadin", "DoÄŸubayazÄ±t", "EleÅŸkirt", "Hamur", "Merkez", "Patnos", "TaÅŸlÄ±Ã§ay", "Tutak"],
            "Aksaray": ["AÄŸaÃ§Ã¶ren", "Eskil", "GÃ¼laÄŸaÃ§", "GÃ¼zelyurt", "Merkez", "OrtakÃ¶y", "SarÄ±yahÅŸi", "SultanhanÄ±"],
            "Amasya": ["GÃ¶ynÃ¼cek", "GÃ¼mÃ¼ÅŸhacÄ±kÃ¶y", "HamamÃ¶zÃ¼", "Merkez", "Merzifon", "Suluova", "TaÅŸova"],
            "Ankara": ["Akyurt", "AltÄ±ndaÄŸ", "AyaÅŸ", "Bala", "BeypazarÄ±", "Ã‡amlÄ±dere", "Ã‡ankaya", "Ã‡ubuk", "ElmadaÄŸ", "Etimesgut", "Evren", "GÃ¶lbaÅŸÄ±", "GÃ¼dÃ¼l", "Haymana", "Kahramankazan", "Kalecik", "KeÃ§iÃ¶ren", "KÄ±zÄ±lcahamam", "Mamak", "NallÄ±han", "PolatlÄ±", "Pursaklar", "Sincan", "ÅžereflikoÃ§hisar", "Yenimahalle"],
            "Antalya": ["Akseki", "Aksu", "Alanya", "Demre", "DÃ¶ÅŸemealtÄ±", "ElmalÄ±", "Finike", "GazipaÅŸa", "GÃ¼ndoÄŸmuÅŸ", "Ä°bradÄ±", "KaÅŸ", "Kemer", "Kepez", "KonyaaltÄ±", "Korkuteli", "Kumluca", "Manavgat", "MuratpaÅŸa", "Serik"],
            "Ardahan": ["Ã‡Ä±ldÄ±r", "Damal", "GÃ¶le", "Hanak", "Merkez", "Posof"],
            "Artvin": ["ArdanuÃ§", "Arhavi", "BorÃ§ka", "Hopa", "KemalpaÅŸa", "Merkez", "Murgul", "ÅžavÅŸat", "Yusufeli"],
            "AydÄ±n": ["BozdoÄŸan", "Buharkent", "Ã‡ine", "Didim", "Efeler", "Germencik", "Ä°ncirliova", "Karacasu", "Karpuzlu", "KoÃ§arlÄ±", "KÃ¶ÅŸk", "KuÅŸadasÄ±", "Kuyucak", "Nazilli", "SÃ¶ke", "Sultanhisar", "Yenipazar"],
            "BalÄ±kesir": ["AltÄ±eylÃ¼l", "AyvalÄ±k", "Balya", "BandÄ±rma", "BigadiÃ§", "Burhaniye", "Dursunbey", "Edremit", "Erdek", "GÃ¶meÃ§", "GÃ¶nen", "Havran", "Ä°vrindi", "Karesi", "Kepsut", "Manyas", "Marmara", "SavaÅŸtepe", "SÄ±ndÄ±rgÄ±", "Susurluk"],
            "BartÄ±n": ["Amasra", "KurucaÅŸile", "Merkez", "Ulus"],
            "Batman": ["BeÅŸiri", "GercÃ¼ÅŸ", "Hasankeyf", "Kozluk", "Merkez", "Sason"],
            "Bayburt": ["AydÄ±ntepe", "DemirÃ¶zÃ¼", "Merkez"],
            "Bilecik": ["BozÃ¼yÃ¼k", "GÃ¶lpazarÄ±", "Ä°nhisar", "Merkez", "Osmaneli", "Pazaryeri", "SÃ¶ÄŸÃ¼t", "Yenipazar"],
            "BingÃ¶l": ["AdaklÄ±", "GenÃ§", "KarlÄ±ova", "KiÄŸÄ±", "Merkez", "Solhan", "Yayladere", "Yedisu"],
            "Bitlis": ["Adilcevaz", "Ahlat", "GÃ¼roymak", "Hizan", "Merkez", "Mutki", "Tatvan"],
            "Bolu": ["DÃ¶rtdivan", "Gerede", "GÃ¶ynÃ¼k", "KÄ±brÄ±scÄ±k", "Mengen", "Merkez", "Mudurnu", "Seben", "YeniÃ§aÄŸa"],
            "Burdur": ["AÄŸlasun", "AltÄ±nyayla", "Bucak", "Ã‡avdÄ±r", "Ã‡eltikÃ§i", "GÃ¶lhisar", "KaramanlÄ±", "Kemer", "Merkez", "Tefenni", "YeÅŸilova"],
            "Bursa": ["BÃ¼yÃ¼korhan", "Gemlik", "GÃ¼rsu", "HarmancÄ±k", "Ä°negÃ¶l", "Ä°znik", "K4aracabey", "Keles", "Kestel", "Mudanya", "MustafakemalpaÅŸa", "NilÃ¼fer", "Orhaneli", "Orhangazi", "Osmangazi", "YeniÅŸehir", "YÄ±ldÄ±rÄ±m"],
            "Ã‡anakkale": ["AyvacÄ±k", "BayramiÃ§", "Biga", "Bozcaada", "Ã‡an", "Eceabat", "Ezine", "Gelibolu", "GÃ¶kÃ§eada", "Lapseki", "Merkez", "Yenice"],
            "Ã‡ankÄ±rÄ±": ["Atkaracalar", "BayramÃ¶ren", "Ã‡erkeÅŸ", "Eldivan", "Ilgaz", "KÄ±zÄ±lÄ±rmak", "Korgun", "KurÅŸunlu", "Merkez", "Orta", "ÅžabanÃ¶zÃ¼", "YapraklÄ±"],
            "Ã‡orum": ["Alaca", "Bayat", "BoÄŸazkale", "Dodurga", "Ä°skilip", "KargÄ±", "LaÃ§in", "MecitÃ¶zÃ¼", "Merkez", "OÄŸuzlar", "OrtakÃ¶y", "OsmancÄ±k", "Sungurlu", "UÄŸurludaÄŸ"],
            "Denizli": ["AcÄ±payam", "BabadaÄŸ", "Baklan", "Bekilli", "BeyaÄŸaÃ§", "Bozkurt", "Buldan", "Ã‡al", "Ã‡ameli", "Ã‡ardak", "Ã‡ivril", "GÃ¼ney", "Honaz", "Kale", "Merkezefendi", "Pamukkale", "SaraykÃ¶y", "Serinhisar", "Tavas"],
            "DiyarbakÄ±r": ["BaÄŸlar", "Bismil", "Ã‡ermik", "Ã‡Ä±nar", "Ã‡Ã¼ngÃ¼ÅŸ", "Dicle", "EÄŸil", "Ergani", "Hani", "Hazro", "KayapÄ±nar", "KocakÃ¶y", "Kulp", "Lice", "Silvan", "Sur", "YeniÅŸehir"],
            "DÃ¼zce": ["AkÃ§akoca", "Ã‡ilimli", "Cumayeri", "GÃ¶lyaka", "GÃ¼mÃ¼ÅŸova", "KaynaÅŸlÄ±", "Merkez", "YÄ±ÄŸÄ±lca"],
            "Edirne": ["Enez", "Havsa", "Ä°psala", "KeÅŸan", "LalapaÅŸa", "MeriÃ§", "Merkez", "SÃ¼loÄŸlu", "UzunkÃ¶prÃ¼"],
            "ElazÄ±ÄŸ": ["AÄŸÄ±n", "Alacakaya", "ArÄ±cak", "Baskil", "KarakoÃ§an", "Keban", "KovancÄ±lar", "Maden", "Merkez", "Palu", "Sivrice"],
            "Erzincan": ["Ã‡ayÄ±rlÄ±", "Ä°liÃ§", "Kemah", "Kemaliye", "Merkez", "Otlukbeli", "Refahiye", "Tercan", "ÃœzÃ¼mlÃ¼"],
            "Erzurum": ["AÅŸkale", "Aziziye", "Ã‡at", "HÄ±nÄ±s", "Horasan", "Ä°spir", "KaraÃ§oban", "KarayazÄ±", "KÃ¶prÃ¼kÃ¶y", "Narman", "Oltu", "Olur", "PalandÃ¶ken", "Pasinler", "Pazaryolu", "Åženkaya", "Tekman", "Tortum", "Uzundere", "Yakutiye"],
            "EskiÅŸehir": ["Alpu", "Beylikova", "Ã‡ifteler", "GÃ¼nyÃ¼zÃ¼", "Han", "Ä°nÃ¶nÃ¼", "Mahmudiye", "Mihalgazi", "MihalÄ±Ã§Ã§Ä±k", "OdunpazarÄ±", "SarÄ±cakaya", "Seyitgazi", "Sivrihisar", "TepebaÅŸÄ±"],
            "Gaziantep": ["Araban", "Ä°slahiye", "KarkamÄ±ÅŸ", "Nizip", "NurdaÄŸÄ±", "OÄŸuzeli", "Åžahinbey", "Åžehitkamil", "Yavuzeli"],
            "Giresun": ["Alucra", "Bulancak", "Ã‡amoluk", "Ã‡anakÃ§Ä±", "Dereli", "DoÄŸankent", "Espiye", "Eynesil", "GÃ¶rele", "GÃ¼ce", "KeÅŸap", "Merkez", "Piraziz", "Åžebinkarahisar", "Tirebolu", "YaÄŸlÄ±dere"],
            "GÃ¼mÃ¼ÅŸhane": ["Kelkit", "KÃ¶se", "KÃ¼rtÃ¼n", "Merkez", "Åžiran", "Torul"],
            "Hakkari": ["Ã‡ukurca", "Derecik", "Merkez", "Åžemdinli", "YÃ¼ksekova"],
            "Hatay": ["AltÄ±nÃ¶zÃ¼", "Antakya", "Arsuz", "Belen", "Defne", "DÃ¶rtyol", "Erzin", "Hassa", "Ä°skenderun", "KÄ±rÄ±khan", "Kumlu", "Payas", "ReyhanlÄ±", "SamandaÄŸ", "YayladaÄŸÄ±"],
            "IÄŸdÄ±r": ["AralÄ±k", "Karakoyunlu", "Merkez", "Tuzluca"],
            "Isparta": ["Aksu", "Atabey", "EÄŸirdir", "Gelendost", "GÃ¶nen", "KeÃ§iborlu", "Merkez", "Senirkent", "SÃ¼tÃ§Ã¼ler", "ÅžarkikaraaÄŸaÃ§", "Uluborlu", "YalvaÃ§", "YeniÅŸarbademli"],
            "Ä°stanbul": ["Adalar", "ArnavutkÃ¶y", "AtaÅŸehir", "AvcÄ±lar", "BaÄŸcÄ±lar", "BahÃ§elievler", "BakÄ±rkÃ¶y", "BaÅŸakÅŸehir", "BayrampaÅŸa", "BeÅŸiktaÅŸ", "Beykoz", "BeylikdÃ¼zÃ¼", "BeyoÄŸlu", "BÃ¼yÃ¼kÃ§ekmece", "Ã‡atalca", "Ã‡ekmekÃ¶y", "Esenler", "Esenyurt", "EyÃ¼psultan", "Fatih", "GaziosmanpaÅŸa", "GÃ¼ngÃ¶ren", "KadÄ±kÃ¶y", "KaÄŸÄ±thane", "Kartal", "KÃ¼Ã§Ã¼kÃ§ekmece", "Maltepe", "Pendik", "Sancaktepe", "SarÄ±yer", "Silivri", "Sultanbeyli", "Sultangazi", "Åžile", "ÅžiÅŸli", "Tuzla", "Ãœmraniye", "ÃœskÃ¼dar", "Zeytinburnu"],
            "Ä°zmir": ["AliaÄŸa", "BalÃ§ova", "BayÄ±ndÄ±r", "BayraklÄ±", "Bergama", "BeydaÄŸ", "Bornova", "Buca", "Ã‡eÅŸme", "Ã‡iÄŸli", "Dikili", "FoÃ§a", "Gaziemir", "GÃ¼zelbahÃ§e", "KarabaÄŸlar", "Karaburun", "KarÅŸÄ±yaka", "KemalpaÅŸa", "KÄ±nÄ±k", "Kiraz", "Konak", "Menderes", "Menemen", "NarlÄ±dere", "Ã–demiÅŸ", "Seferihisar", "SelÃ§uk", "Tire", "TorbalÄ±", "Urla"],
            "KahramanmaraÅŸ": ["AfÅŸin", "AndÄ±rÄ±n", "Ã‡aÄŸlayancerit", "DulkadiroÄŸlu", "EkinÃ¶zÃ¼", "Elbistan", "GÃ¶ksun", "Nurhak", "OnikiÅŸubat", "PazarcÄ±k", "TÃ¼rkoÄŸlu"],
            "KarabÃ¼k": ["Eflani", "Eskipazar", "Merkez", "OvacÄ±k", "Safranbolu", "Yenice"],
            "Karaman": ["AyrancÄ±", "BaÅŸyayla", "Ermenek", "KazÄ±mkarabekir", "Merkez", "SarÄ±veliler"],
            "Kars": ["Akyaka", "ArpaÃ§ay", "Digor", "KaÄŸÄ±zman", "Merkez", "SarÄ±kamÄ±ÅŸ", "Selim", "Susuz"],
            "Kastamonu": ["Abana", "AÄŸlÄ±", "AraÃ§", "Azdavay", "Bozkurt", "Cide", "Ã‡atalzeytin", "Daday", "Devrekani", "DoÄŸanyurt", "HanÃ¶nÃ¼", "Ä°hsangazi", "Ä°nebolu", "KÃ¼re", "Merkez", "PÄ±narbaÅŸÄ±", "Seydiler", "Åženpazar", "TaÅŸkÃ¶prÃ¼", "Tosya"],
            "Kayseri": ["AkkÄ±ÅŸla", "BÃ¼nyan", "Develi", "Felahiye", "HacÄ±lar", "Ä°ncesu", "Kocasinan", "Melikgazi", "Ã–zvatan", "PÄ±narbaÅŸÄ±", "SarÄ±oÄŸlan", "SarÄ±z", "Talas", "Tomarza", "YahyalÄ±", "YeÅŸilhisar"],
            "Kilis": ["Elbeyli", "Merkez", "Musabeyli", "Polateli"],
            "KÄ±rÄ±kkale": ["BahÅŸÄ±lÄ±", "BalÄ±ÅŸeyh", "Ã‡elebi", "Delice", "KarakeÃ§ili", "Keskin", "Merkez", "Sulakyurt", "YahÅŸihan"],
            "KÄ±rklareli": ["Babaeski", "DemirkÃ¶y", "KofÃ§az", "LÃ¼leburgaz", "Merkez", "PehlivankÃ¶y", "PÄ±narhisar", "Vize"],
            "KÄ±rÅŸehir": ["AkÃ§akent", "AkpÄ±nar", "Boztepe", "Ã‡iÃ§ekdaÄŸÄ±", "Kaman", "Merkez", "Mucur"],
            "Kocaeli": ["BaÅŸiskele", "Ã‡ayÄ±rova", "DarÄ±ca", "Derince", "DilovasÄ±", "Gebze", "GÃ¶lcÃ¼k", "Ä°zmit", "KandÄ±ra", "KaramÃ¼rsel", "Kartepe", "KÃ¶rfez"],
            "Konya": ["AhÄ±rlÄ±", "AkÃ¶ren", "AkÅŸehir", "AltÄ±nekin", "BeyÅŸehir", "BozkÄ±r", "Cihanbeyli", "Ã‡eltik", "Ã‡umra", "Derbent", "Derebucak", "DoÄŸanhisar", "Emirgazi", "EreÄŸli", "GÃ¼neysÄ±nÄ±r", "Hadim", "HalkapÄ±nar", "HÃ¼yÃ¼k", "IlgÄ±n", "KadÄ±nhanÄ±", "KarapÄ±nar", "Karatay", "Kulu", "Meram", "SarayÃ¶nÃ¼", "SelÃ§uklu", "SeydiÅŸehir", "TaÅŸkent", "TuzlukÃ§u", "YalÄ±hÃ¼yÃ¼k", "Yunak"],
            "KÃ¼tahya": ["AltÄ±ntaÅŸ", "Aslanapa", "Ã‡avdarhisar", "DomaniÃ§", "DumlupÄ±nar", "Emet", "Gediz", "HisarcÄ±k", "Merkez", "Pazarlar", "Simav", "Åžaphane", "TavÅŸanlÄ±"],
            "Malatya": ["AkÃ§adaÄŸ", "Arapgir", "Arguvan", "Battalgazi", "Darende", "DoÄŸanÅŸehir", "DoÄŸanyol", "Hekimhan", "Kale", "Kuluncak", "PÃ¼tÃ¼rge", "YazÄ±han", "YeÅŸilyurt"],
            "Manisa": ["Ahmetli", "Akhisar", "AlaÅŸehir", "Demirci", "GÃ¶lmarmara", "GÃ¶rdes", "KÄ±rkaÄŸaÃ§", "KÃ¶prÃ¼baÅŸÄ±", "Kula", "Salihli", "SarÄ±gÃ¶l", "SaruhanlÄ±", "Selendi", "Soma", "Åžehzadeler", "Turgutlu", "Yunusemre"],
            "Mardin": ["Artuklu", "DargeÃ§it", "Derik", "KÄ±zÄ±ltepe", "MazÄ±daÄŸÄ±", "Midyat", "Nusaybin", "Ã–merli", "Savur", "YeÅŸilli"],
            "Mersin": ["Akdeniz", "Anamur", "AydÄ±ncÄ±k", "BozyazÄ±", "Ã‡amlÄ±yayla", "Erdemli", "GÃ¼lnar", "Mezitli", "Mut", "Silifke", "Tarsus", "Toroslar", "YeniÅŸehir"],
            "MuÄŸla": ["Bodrum", "Dalaman", "DatÃ§a", "Fethiye", "KavaklÄ±dere", "KÃ¶yceÄŸiz", "Marmaris", "MenteÅŸe", "Milas", "Ortaca", "Seydikemer", "Ula", "YataÄŸan"],
            "MuÅŸ": ["BulanÄ±k", "HaskÃ¶y", "Korkut", "Malazgirt", "Merkez", "Varto"],
            "NevÅŸehir": ["AcÄ±gÃ¶l", "Avanos", "Derinkuyu", "GÃ¼lÅŸehir", "HacÄ±bektaÅŸ", "KozaklÄ±", "Merkez", "ÃœrgÃ¼p"],
            "NiÄŸde": ["Altunhisar", "Bor", "Ã‡amardÄ±", "Ã‡iftlik", "Merkez", "UlukÄ±ÅŸla"],
            "Ordu": ["AkkuÅŸ", "AltÄ±nordu", "AybastÄ±", "Ã‡amaÅŸ", "Ã‡atalpÄ±nar", "Ã‡aybaÅŸÄ±", "Fatsa", "GÃ¶lkÃ¶y", "GÃ¼lyalÄ±", "GÃ¼rgentepe", "Ä°kizce", "KabadÃ¼z", "KabataÅŸ", "Korgan", "Kumru", "Mesudiye", "PerÅŸembe", "Ulubey", "Ãœnye"],
            "Osmaniye": ["BahÃ§e", "DÃ¼ziÃ§i", "Hasanbeyli", "Kadirli", "Merkez", "Sumbas", "Toprakkale"],
            "Rize": ["ArdeÅŸen", "Ã‡amlÄ±hemÅŸin", "Ã‡ayeli", "DerepazarÄ±", "FÄ±ndÄ±klÄ±", "GÃ¼neysu", "HemÅŸin", "Ä°kizdere", "Iyidere", "Kalkandere", "Merkez", "Pazar"],
            "Sakarya": ["AdapazarÄ±", "AkyazÄ±", "Arifiye", "Erenler", "Ferizli", "Geyve", "Hendek", "KarapÃ¼rÃ§ek", "Karasu", "Kaynarca", "Kocaali", "Pamukova", "Sapanca", "Serdivan", "SÃ¶ÄŸÃ¼tlÃ¼", "TaraklÄ±"],
            "Samsun": ["19 MayÄ±s", "AlaÃ§am", "AsarcÄ±k", "Atakum", "AyvacÄ±k", "Bafra", "Canik", "Ã‡arÅŸamba", "Havza", "Ä°lkadÄ±m", "Kavak", "Ladik", "SalÄ±pazarÄ±", "TekkekÃ¶y", "Terme", "VezirkÃ¶prÃ¼", "Yakakent"],
            "ÅžanlÄ±urfa": ["AkÃ§akale", "Birecik", "Bozova", "CeylanpÄ±nar", "EyyÃ¼biye", "Halfeti", "Haliliye", "Harran", "Hilvan", "KarakÃ¶prÃ¼", "Siverek", "SuruÃ§", "ViranÅŸehir"],
            "Siirt": ["Baykan", "Eruh", "Kurtalan", "Merkez", "Pervari", "Åžirvan", "Tillo"],
            "Sinop": ["AyancÄ±k", "Boyabat", "Dikmen", "DuraÄŸan", "Erfelek", "Gerze", "Merkez", "SaraydÃ¼zÃ¼", "TÃ¼rkeli"],
            "Sivas": ["AkÄ±ncÄ±lar", "AltÄ±nyayla", "DivriÄŸi", "DoÄŸanÅŸar", "Gemerek", "GÃ¶lova", "GÃ¼rÃ¼n", "Hafik", "Ä°mranlÄ±", "Kangal", "Koyulhisar", "Merkez", "SuÅŸehri", "ÅžarkÄ±ÅŸla", "UlaÅŸ", "YÄ±ldÄ±zeli", "Zara"],
            "ÅžÄ±rnak": ["BeytÃ¼ÅŸÅŸebap", "Cizre", "GÃ¼Ã§lÃ¼konak", "Ä°dil", "Merkez", "Silopi", "Uludere"],
            "TekirdaÄŸ": ["Ã‡erkezkÃ¶y", "Ã‡orlu", "Ergene", "Hayrabolu", "KapaklÄ±", "Malkara", "MarmaraereÄŸlisi", "MuratlÄ±", "Saray", "SÃ¼leymanpaÅŸa", "ÅžarkÃ¶y"],
            "Tokat": ["Almus", "Artova", "BaÅŸÃ§iftlik", "Erbaa", "Merkez", "Niksar", "Pazar", "ReÅŸadiye", "Sulusaray", "Turhal", "YeÅŸilyurt", "Zile"],
            "Trabzon": ["AkÃ§aabat", "AraklÄ±", "Arsin", "BeÅŸikdÃ¼zÃ¼", "Ã‡arÅŸÄ±baÅŸÄ±", "Ã‡aykara", "DernekpazarÄ±", "DÃ¼zkÃ¶y", "Hayrat", "KÃ¶prÃ¼baÅŸÄ±", "MaÃ§ka", "Of", "Ortahisar", "SÃ¼rmene", "ÅžalpazarÄ±", "Tonya", "VakfÄ±kebir", "Yomra"],
            "Tunceli": ["Ã‡emiÅŸgezek", "Hozat", "Mazgirt", "Merkez", "NazÄ±miye", "OvacÄ±k", "Pertek", "PÃ¼lÃ¼mÃ¼r"],
            "UÅŸak": ["Banaz", "EÅŸme", "KarahallÄ±", "Merkez", "SivaslÄ±", "Ulubey"],
            "Van": ["BahÃ§esaray", "BaÅŸkale", "Ã‡aldÄ±ran", "Ã‡atak", "Edremit", "ErciÅŸ", "GevaÅŸ", "GÃ¼rpÄ±nar", "Ä°pekyolu", "Muradiye", "Ã–zalp", "Saray", "TuÅŸba"],
            "Yalova": ["AltÄ±nova", "Armutlu", "Ã‡Ä±narcÄ±k", "Ã‡iftlikkÃ¶y", "Merkez", "Termal"],
            "Yozgat": ["AkdaÄŸmadeni", "AydÄ±ncÄ±k", "BoÄŸazlÄ±yan", "Ã‡andÄ±r", "Ã‡ayÄ±ralan", "Ã‡ekerek", "KadÄ±ÅŸehri", "Merkez", "Saraykent", "SarÄ±kaya", "Sorgun", "Åžefaatli", "YenifakÄ±lÄ±", "YerkÃ¶y"],
            "Zonguldak": ["AlaplÄ±", "Ã‡aycuma", "Devrek", "EreÄŸli", "GÃ¶kÃ§ebey", "Kilimli", "Kozlu", "Merkez"]
        };

        // --- DATA: COMMERCIAL VEHICLE BRANDS & MODELS ---
        const VEHICLE_BRANDS = {
            "Mercedes-Benz": ["Sprinter", "Vito", "V-Class", "Citan"],
            "Volkswagen": ["Crafter", "Transporter", "Caravelle", "Volt", "Caddy"],
            "Ford": ["Transit", "Transit Custom", "Tourneo", "Ranger"],
            "Fiat": ["Ducato", "Scudo", "Doblo", "Fiorino"],
            "Renault": ["Master", "Trafic", "Kangoo"],
            "Peugeot": ["Boxer", "Expert", "Partner", "Rifter"],
            "CitroÃ«n": ["Jumper", "Jumpy", "Berlingo"],
            "Iveco": ["Daily"],
            "Karsan": ["Jest", "Atak", "Star", "J10"],
            "Otokar": ["Sultan", "Doruk", "Poyraz", "Navigo"],
            "Isuzu": ["Novo", "Turkuaz", "Roybus", "Grand Toro", "NPR"],
            "Temsa": ["Prestij", "Safir", "Maraton", "Opalin"],
            "DiÄŸer": ["DiÄŸer"]
        };

        // --- DATA: VEHICLE TYPES ---
        const VEHICLE_TYPES = ["MinibÃ¼s", "MidibÃ¼s", "OtobÃ¼s", "Okul TaÅŸÄ±tÄ±", "Personel Servisi", "VIP Transfer", "Hafif Ticari"];

        // --- LEGAL TEXTS ---
        const LEGAL_TEXTS = {
            terms: `1. HÄ°ZMET TANIMI\nServisteyim, araÃ§ sahipleri, sÃ¼rÃ¼cÃ¼ler ve servis sorumlularÄ± iÃ§in tasarlanmÄ±ÅŸ dijital bir pazaryeridir.\n\n2. KULLANICI YÃœKÃœMLÃœLÃœKLERÄ°\nKullanÄ±cÄ±lar, platform Ã¼zerinde paylaÅŸtÄ±klarÄ± bilgilerin doÄŸru ve gÃ¼ncel olmasÄ±ndan sorumludur. YanÄ±ltÄ±cÄ± bilgi paylaÅŸmak yasaktÄ±r.\n\n3. Ä°LAN SÃœRESÄ°\nYayÄ±nlanan ilanlar 14 gÃ¼n boyunca yayÄ±nda kalÄ±r, ardÄ±ndan otomatik olarak pasife alÄ±nÄ±r.\n\n4. YASAKLI DAVRANIÅžLAR\nSpam, dolandÄ±rÄ±cÄ±lÄ±k ve yasadÄ±ÅŸÄ± faaliyetler hesabÄ±n kapatÄ±lmasÄ±na neden olur.`,
            privacy: `1. VERÄ° TOPLAMA\nAd, soyad, iletiÅŸim bilgileri ve araÃ§ bilgileri hizmetin saÄŸlanmasÄ± amacÄ±yla toplanÄ±r.\n\n2. VERÄ° KULLANIMI\nToplanan bilgiler sadece eÅŸleÅŸme ve iletiÅŸim amacÄ±yla kullanÄ±lÄ±r. ÃœÃ§Ã¼ncÃ¼ taraflarla izinsiz paylaÅŸÄ±lmaz.\n\n3. GÃœVENLÄ°K\nVerileriniz modern ÅŸifreleme yÃ¶ntemleriyle korunmaktadÄ±r.\n\n4. KULLANICI HAKLARI\nDilediÄŸiniz zaman verilerinizi silebilir veya hesabÄ±nÄ±zÄ± kapatabilirsiniz.`
        };

        // --- UTILITY FUNCTIONS ---
        const generateId = () => Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
        
        const formatDate = (isoString) => {
            if(!isoString) return '';
            return new Date(isoString).toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' });
        };

        const getDaysRemaining = (createdAt) => {
            const postDate = new Date(createdAt);
            const now = new Date();
            const diffTime = Math.abs(now - postDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return Math.max(0, 14 - diffDays);
        };

        const isPostExpired = (createdAt) => getDaysRemaining(createdAt) === 0;

        // --- DATABASE LAYER (IndexedDB) ---
        const DB_NAME = 'servisteyim-db-v2';
        const DB_VERSION = 5; 

        const initDB = () => {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('users')) {
                        const usersStore = db.createObjectStore('users', { keyPath: 'id' });
                        usersStore.createIndex('phoneOrEmail', 'phoneOrEmail', { unique: true });
                    }
                    if (!db.objectStoreNames.contains('posts')) {
                        const postsStore = db.createObjectStore('posts', { keyPath: 'id' });
                        postsStore.createIndex('userId', 'userId', { unique: false });
                        postsStore.createIndex('status', 'status', { unique: false });
                    }
                    if (!db.objectStoreNames.contains('messages')) {
                        const msgsStore = db.createObjectStore('messages', { keyPath: 'id' });
                        msgsStore.createIndex('receiverId', 'receiverId', { unique: false });
                        msgsStore.createIndex('senderId', 'senderId', { unique: false });
                    }
                    if (!db.objectStoreNames.contains('favorites')) {
                        const favStore = db.createObjectStore('favorites', { keyPath: 'id' });
                        favStore.createIndex('userId', 'userId', { unique: false });
                    }
                    if (!db.objectStoreNames.contains('reports')) {
                        const repStore = db.createObjectStore('reports', { keyPath: 'id' });
                        repStore.createIndex('status', 'status', { unique: false });
                    }
                };

                request.onsuccess = (event) => resolve(event.target.result);
                request.onerror = (event) => reject(event.target.error);
            });
        };

        const dbAction = async (storeName, mode, callback) => {
            const db = await initDB();
            const tx = db.transaction(storeName, mode);
            const store = tx.objectStore(storeName);
            return new Promise((resolve, reject) => {
                const request = callback(store);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        };

        const api = {
            users: {
                create: (user) => dbAction('users', 'readwrite', store => store.add(user)),
                get: (id) => dbAction('users', 'readonly', store => store.get(id)),
                getByLogin: async (phoneOrEmail) => {
                    const db = await initDB();
                    return new Promise((resolve) => {
                        const tx = db.transaction('users', 'readonly');
                        const index = tx.objectStore('users').index('phoneOrEmail');
                        const req = index.get(phoneOrEmail);
                        req.onsuccess = () => resolve(req.result ? req.result : null);
                    });
                },
                update: (user) => dbAction('users', 'readwrite', store => store.put(user)),
                getAll: () => dbAction('users', 'readonly', store => store.getAll()),
                delete: (id) => dbAction('users', 'readwrite', store => store.delete(id))
            },
            posts: {
                create: (post) => dbAction('posts', 'readwrite', store => store.add(post)),
                update: (post) => dbAction('posts', 'readwrite', store => store.put(post)),
                getAll: () => dbAction('posts', 'readonly', store => store.getAll()),
                delete: (id) => dbAction('posts', 'readwrite', store => store.delete(id)),
                incrementView: async (id) => {
                    const post = await dbAction('posts', 'readonly', store => store.get(id));
                    if(post) {
                        post.views = (post.views || 0) + 1;
                        await dbAction('posts', 'readwrite', store => store.put(post));
                    }
                }
            },
            messages: {
                send: (msg) => dbAction('messages', 'readwrite', store => store.add(msg)),
                getMyMessages: async (userId) => {
                    const sent = await dbAction('messages', 'readonly', store => store.getAll());
                    return sent.filter(m => m.senderId === userId || m.receiverId === userId);
                },
                delete: (id) => dbAction('messages', 'readwrite', store => store.delete(id))
            },
            favorites: {
                toggle: async (userId, targetId, targetType) => {
                    const all = await dbAction('favorites', 'readonly', store => store.getAll());
                    const existing = all.find(f => f.userId === userId && f.targetId === targetId);
                    if(existing) {
                        await dbAction('favorites', 'readwrite', store => store.delete(existing.id));
                        return false;
                    } else {
                        await dbAction('favorites', 'readwrite', store => store.add({
                            id: generateId(), userId, targetId, targetType, createdAt: new Date().toISOString()
                        }));
                        return true;
                    }
                },
                getMy: async (userId) => {
                    const all = await dbAction('favorites', 'readonly', store => store.getAll());
                    return all.filter(f => f.userId === userId);
                }
            },
            reports: {
                create: (report) => dbAction('reports', 'readwrite', store => store.add(report)),
                getAll: () => dbAction('reports', 'readonly', store => store.getAll()),
                update: (report) => dbAction('reports', 'readwrite', store => store.put(report)),
                delete: (id) => dbAction('reports', 'readwrite', store => store.delete(id))
            }
        };

        // --- CONTEXTS ---
        const AuthContext = createContext(null);

        // --- COMPONENTS ---

        // SVG Icons Component
        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => {
                if (window.feather) window.feather.replace();
            });
            return <i data-feather={name} className={className} style={{ width: size, height: size }}></i>;
        };

        // Toast Notification
        const Toast = ({ msg, type, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, []);
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500'
            };

            return (
                <div className={`fixed top-4 right-4 z-50 ${colors[type]} text-white px-6 py-3 rounded shadow-lg animate-fade-in flex items-center gap-2`}>
                    <span>{msg}</span>
                </div>
            );
        };

        // Modal
        const Modal = ({ isOpen, onClose, title, children, maxWidth = "max-w-md" }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 animate-fade-in">
                    <div className={`bg-white rounded-xl w-full ${maxWidth} max-h-[90vh] overflow-y-auto`}>
                        <div className="p-4 border-b flex justify-between items-center sticky top-0 bg-white z-10">
                            <h3 className="font-bold text-lg">{title}</h3>
                            <button onClick={onClose} className="p-1 hover:bg-gray-100 rounded-full"><Icon name="x" /></button>
                        </div>
                        <div className="p-4">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        // --- PAGES ---

        // Public Profile Component
        const PublicProfile = ({ userId, onBack }) => {
            const [profileUser, setProfileUser] = useState(null);
            const [userPosts, setUserPosts] = useState([]);

            useEffect(() => {
                const loadProfile = async () => {
                    const user = await api.users.get(userId);
                    setProfileUser(user);
                    const allPosts = await api.posts.getAll();
                    // Show active posts of this user
                    const active = allPosts.filter(p => p.userId === userId && p.status === 'active' && !isPostExpired(p.createdAt));
                    setUserPosts(active);
                };
                loadProfile();
            }, [userId]);

            if (!profileUser) return <div className="p-10 text-center">Profil yÃ¼kleniyor...</div>;

            return (
                <div className="bg-gray-50 min-h-screen pb-24">
                    {/* Header */}
                    <div className="p-4 border-b bg-white flex items-center gap-3 sticky top-0 z-10">
                        <button onClick={onBack} className="p-2 hover:bg-gray-100 rounded-full"><Icon name="chevron-left" /></button>
                        <h2 className="font-bold text-lg">KullanÄ±cÄ± Profili</h2>
                    </div>

                    {/* Profile Info */}
                    <div className="bg-white p-6 mb-4 shadow-sm">
                        <div className="flex flex-col items-center gap-3 text-center">
                            <div className="w-24 h-24 bg-gray-200 rounded-full overflow-hidden border-4 border-gray-50 shadow-sm">
                                {profileUser.profileImage ? <img src={profileUser.profileImage} className="w-full h-full object-cover"/> : <div className="w-full h-full flex items-center justify-center text-4xl">ðŸ‘¤</div>}
                            </div>
                            <div>
                                <h2 className="text-2xl font-bold">{profileUser.name} {profileUser.surname}</h2>
                                <div className="flex gap-2 justify-center mt-2">
                                    {profileUser.isSponsored && <span className="bg-yellow-100 text-yellow-700 text-xs px-2 py-0.5 rounded">VIP Ãœye</span>}
                                    {profileUser.idVerified && <span className="bg-blue-100 text-blue-700 text-xs px-2 py-0.5 rounded flex items-center gap-1"><Icon name="shield" size={10}/> DoÄŸrulanmÄ±ÅŸ</span>}
                                </div>
                            </div>
                        </div>
                        
                        <div className="mt-6 grid grid-cols-3 gap-2 text-center border-t pt-4">
                            <div>
                                <span className="block font-bold text-xl">{userPosts.length}</span>
                                <span className="text-xs text-gray-500">Aktif Ä°lan</span>
                            </div>
                            <div>
                                <span className="block font-bold text-xl">{profileUser.experienceYears || '-'}</span>
                                <span className="text-xs text-gray-500">YÄ±l Deneyim</span>
                            </div>
                            <div>
                                <span className="block font-bold text-xl">5.0</span>
                                <span className="text-xs text-gray-500">Puan</span>
                            </div>
                        </div>
                    </div>

                    {/* Professional Details */}
                    {(profileUser.vehicleType || profileUser.licenseClass) && (
                        <div className="bg-white p-4 mb-4 shadow-sm">
                            <h3 className="font-bold text-gray-800 mb-3">AraÃ§ & Yetkinlikler</h3>
                            <div className="flex flex-wrap gap-2">
                                {profileUser.vehicleType && <span className="bg-gray-100 px-3 py-1 rounded text-sm">{profileUser.vehicleType}</span>}
                                {profileUser.vehicleSeats && <span className="bg-gray-100 px-3 py-1 rounded text-sm">{profileUser.vehicleSeats} Koltuk</span>}
                                {profileUser.licenseClass && <span className="bg-gray-100 px-3 py-1 rounded text-sm">{profileUser.licenseClass} Ehliyet</span>}
                            </div>
                        </div>
                    )}

                    {/* About */}
                    <div className="bg-white p-4 mb-4 shadow-sm">
                        <h3 className="font-bold text-gray-800 mb-2">HakkÄ±nda</h3>
                        <p className="text-gray-600 text-sm leading-relaxed">{profileUser.about || 'Bu kullanÄ±cÄ± henÃ¼z bir aÃ§Ä±klama girmedi.'}</p>
                    </div>

                    {/* User's Posts */}
                    <div className="p-4">
                        <h3 className="font-bold text-gray-800 mb-3">KullanÄ±cÄ±nÄ±n Ä°lanlarÄ±</h3>
                        <div className="space-y-3">
                            {userPosts.map(post => (
                                <div key={post.id} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                                    <h4 className="font-bold text-gray-800 line-clamp-1">{post.title}</h4>
                                    <p className="text-xs text-gray-500 mt-1">{post.location.address}</p>
                                    <div className="flex justify-between items-center mt-2">
                                        <span className="text-xs bg-brand/10 text-brand px-2 py-0.5 rounded">{post.category}</span>
                                        <span className="text-xs text-gray-400">{formatDate(post.createdAt)}</span>
                                    </div>
                                </div>
                            ))}
                            {userPosts.length === 0 && <div className="text-gray-400 text-center py-4">Aktif ilan bulunmuyor.</div>}
                        </div>
                    </div>
                </div>
            );
        };
        // Login / Register 
        const AuthPage = ({ onLogin }) => {
            const [isLogin, setIsLogin] = useState(true);
            const [formData, setFormData] = useState({
                email: '', password: '', name: '', surname: '', phone: '', terms: false, privacy: false
            });
            const [error, setError] = useState('');
            const [toast, setToast] = useState(null);

            // Modal States
            const [showTermsModal, setShowTermsModal] = useState(false);
            const [showPrivacyModal, setShowPrivacyModal] = useState(false);
            const [showForgotModal, setShowForgotModal] = useState(false);
            const [forgotEmail, setForgotEmail] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');

                if (isLogin) {
                    // Admin Backdoor
                    if (formData.email === 'admin@admin.com' && formData.password === 'admin123') {
                        const adminUser = {
                            id: 'admin', name: 'Sistem', surname: 'YÃ¶neticisi', 
                            email: 'admin@admin.com', isSponsored: true, role: 'admin',
                            profileImage: null, emailVerified: true, phoneVerified: true, idVerified: true,
                            lastNameChange: new Date(new Date().setMonth(new Date().getMonth() - 4)).toISOString() 
                        };
                        onLogin(adminUser);
                        return;
                    }

                    const user = await api.users.getByLogin(formData.email);
                    if (user && user.password === formData.password) {
                        onLogin(user);
                    } else {
                        setError('HatalÄ± kullanÄ±cÄ± adÄ± veya ÅŸifre');
                    }
                } else {
                    // Register Validation
                    if (!formData.email.match(/@(gmail\.com|hotmail\.com|outlook\.com)$/)) {
                        setError('Sadece Gmail, Hotmail veya Outlook kabul edilir.');
                        return;
                    }
                    if (formData.email === 'admin@admin.com') {
                        setError('Bu email kullanÄ±lamaz.');
                        return;
                    }
                    if (!formData.terms || !formData.privacy) {
                        setError('SÃ¶zleÅŸmeleri onaylamanÄ±z gerekmektedir.');
                        return;
                    }

                    try {
                        const newUser = {
                            id: generateId(),
                            ...formData,
                            // CRITICAL FIX: Add phoneOrEmail field for indexing
                            phoneOrEmail: formData.email,
                            role: 'user',
                            createdAt: new Date().toISOString(),
                            emailVerified: false,
                            isSponsored: false,
                            lastNameChange: new Date().toISOString() 
                        };
                        await api.users.create(newUser);
                        setIsLogin(true);
                        alert('KayÄ±t baÅŸarÄ±lÄ±! LÃ¼tfen giriÅŸ yapÄ±n.');
                    } catch (err) {
                        console.error(err);
                        setError('Bu email veya telefon zaten kayÄ±tlÄ±.');
                    }
                }
            };

            const handleForgotPassword = async (e) => {
                e.preventDefault();
                const user = await api.users.getByLogin(forgotEmail);
                
                setShowForgotModal(false);
                setForgotEmail('');
                
                if (user) {
                    setToast({ msg: 'Åžifre sÄ±fÄ±rlama baÄŸlantÄ±sÄ± e-posta adresinize gÃ¶nderildi. (SimÃ¼lasyon)', type: 'success' });
                } else {
                    setToast({ msg: 'Bu e-posta adresiyle kayÄ±tlÄ± kullanÄ±cÄ± bulunamadÄ±.', type: 'error' });
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-brand-dark to-brand-light p-4">
                    {toast && <Toast {...toast} onClose={() => setToast(null)} />}
                    
                    <div className="bg-white w-full max-w-md p-8 rounded-2xl shadow-2xl">
                        <div className="text-center mb-8">
                            <h1 className="text-3xl font-bold text-brand mb-2">Servisteyim 2.0</h1>
                            <p className="text-gray-500">{isLogin ? 'HoÅŸ geldiniz' : 'AramÄ±za KatÄ±lÄ±n'}</p>
                        </div>

                        {error && <div className="bg-red-100 text-red-600 p-3 rounded mb-4 text-sm">{error}</div>}

                        <form onSubmit={handleSubmit} className="space-y-4">
                            <input 
                                type="email" placeholder="Email / Telefon" required
                                className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-brand focus:outline-none"
                                value={formData.email}
                                onChange={e => setFormData({...formData, email: e.target.value})}
                            />
                            <div>
                                <input 
                                    type="password" placeholder="Åžifre" required
                                    className="w-full p-3 border rounded-lg focus:ring-2 focus:ring-brand focus:outline-none"
                                    value={formData.password}
                                    onChange={e => setFormData({...formData, password: e.target.value})}
                                />
                                {isLogin && (
                                    <div className="text-right mt-1">
                                        <button 
                                            type="button"
                                            onClick={() => setShowForgotModal(true)}
                                            className="text-xs text-brand font-bold hover:underline"
                                        >
                                            Åžifremi Unuttum?
                                        </button>
                                    </div>
                                )}
                            </div>

                            {!isLogin && (
                                <>
                                    <div className="grid grid-cols-2 gap-2">
                                        <input 
                                            type="text" placeholder="Ad" required
                                            className="w-full p-3 border rounded-lg"
                                            onChange={e => setFormData({...formData, name: e.target.value})}
                                        />
                                        <input 
                                            type="text" placeholder="Soyad" required
                                            className="w-full p-3 border rounded-lg"
                                            onChange={e => setFormData({...formData, surname: e.target.value})}
                                        />
                                    </div>
                                    <div className="space-y-2 text-sm text-gray-600">
                                        <label className="flex items-center gap-2">
                                            <input type="checkbox" required onChange={e => setFormData({...formData, terms: e.target.checked})} />
                                            <span>
                                                <button type="button" onClick={() => setShowTermsModal(true)} className="text-brand font-bold hover:underline">KullanÄ±cÄ± SÃ¶zleÅŸmesini</button> kabul ediyorum
                                            </span>
                                        </label>
                                        <label className="flex items-center gap-2">
                                            <input type="checkbox" required onChange={e => setFormData({...formData, privacy: e.target.checked})} />
                                            <span>
                                                <button type="button" onClick={() => setShowPrivacyModal(true)} className="text-brand font-bold hover:underline">Gizlilik PolitikasÄ±nÄ±</button> kabul ediyorum
                                            </span>
                                        </label>
                                    </div>
                                </>
                            )}

                            <button className="w-full bg-brand hover:bg-brand-dark text-white font-bold py-3 rounded-lg transition">
                                {isLogin ? 'GiriÅŸ Yap' : 'KayÄ±t Ol'}
                            </button>
                        </form>

                        <div className="mt-6 text-center text-sm">
                            <span className="text-gray-500">{isLogin ? 'HesabÄ±n yok mu?' : 'Zaten Ã¼ye misin?'}</span>
                            <button 
                                onClick={() => setIsLogin(!isLogin)}
                                className="ml-2 text-brand font-bold hover:underline"
                            >
                                {isLogin ? 'KayÄ±t Ol' : 'GiriÅŸ Yap'}
                            </button>
                        </div>
                    </div>

                    {/* Modals for Auth Page */}
                    <Modal isOpen={showTermsModal} onClose={() => setShowTermsModal(false)} title="KullanÄ±cÄ± SÃ¶zleÅŸmesi">
                        <div className="whitespace-pre-wrap text-sm text-gray-700 leading-relaxed">
                            {LEGAL_TEXTS.terms}
                        </div>
                        <div className="mt-4">
                            <button onClick={() => setShowTermsModal(false)} className="w-full bg-gray-200 text-gray-800 py-2 rounded font-bold">Kapat</button>
                        </div>
                    </Modal>

                    <Modal isOpen={showPrivacyModal} onClose={() => setShowPrivacyModal(false)} title="Gizlilik PolitikasÄ±">
                        <div className="whitespace-pre-wrap text-sm text-gray-700 leading-relaxed">
                            {LEGAL_TEXTS.privacy}
                        </div>
                        <div className="mt-4">
                            <button onClick={() => setShowPrivacyModal(false)} className="w-full bg-gray-200 text-gray-800 py-2 rounded font-bold">Kapat</button>
                        </div>
                    </Modal>

                    <Modal isOpen={showForgotModal} onClose={() => setShowForgotModal(false)} title="Åžifre SÄ±fÄ±rlama">
                        <form onSubmit={handleForgotPassword} className="space-y-4">
                            <p className="text-sm text-gray-600">
                                KayÄ±tlÄ± e-posta adresinizi girin. Size ÅŸifrenizi sÄ±fÄ±rlamanÄ±z iÃ§in bir baÄŸlantÄ± gÃ¶ndereceÄŸiz.
                            </p>
                            <input 
                                type="email" 
                                placeholder="E-posta Adresiniz" 
                                required
                                className="w-full p-3 border rounded-lg"
                                value={forgotEmail}
                                onChange={e => setForgotEmail(e.target.value)}
                            />
                            <button className="w-full bg-brand text-white py-2 rounded font-bold">GÃ¶nder</button>
                        </form>
                    </Modal>
                </div>
            );
        };

        // Dashboard / Feed - Updated with Location Sorting
        const Feed = ({ currentUser, onItemClick, onViewProfile }) => {
            const [posts, setPosts] = useState([]);
            const [filter, setFilter] = useState({ category: 'all' });
            
            const [fuelPrices, setFuelPrices] = useState({ 
                benzin: 54.91, 
                motorin: 59.41, 
                lpg: 27.71 
            });
            
            // New Search States
            const [searchCity, setSearchCity] = useState('');
            const [searchVehicle, setSearchVehicle] = useState('');
            const [myMessages, setMyMessages] = useState([]); 
            const [showInboxModal, setShowInboxModal] = useState(false); 
            const [allUsers, setAllUsers] = useState({}); 
            
            const [myFavs, setMyFavs] = useState([]);
            const [showMsgModal, setShowMsgModal] = useState(false);
            const [showReportModal, setShowReportModal] = useState(false);
            const [activePost, setActivePost] = useState(null);
            const [msgText, setMsgText] = useState('');
            const [reportData, setReportData] = useState({ reason: 'spam', description: '' });
            const [toast, setToast] = useState(null);
            
            // --- NEW: Report & Reply Logic ---
            const [myReports, setMyReports] = useState([]);
            const [activeReplyId, setActiveReplyId] = useState(null);
            const [replyText, setReplyText] = useState('');

            // --- NEW: Chat System States ---
            const [inboxTab, setInboxTab] = useState('messages'); // 'messages' or 'reports'
            const [selectedChatUser, setSelectedChatUser] = useState(null);
            const [chatInput, setChatInput] = useState('');
            const messagesEndRef = useRef(null);

            useEffect(() => {
                loadPosts();
                const fetchFuelData = async () => {
                    try {
                        setFuelPrices(prev => ({
                            benzin: +(54.91 + (Math.random() * 0.04 - 0.02)).toFixed(2),
                            motorin: +(59.41 + (Math.random() * 0.04 - 0.02)).toFixed(2),
                            lpg: +(27.71 + (Math.random() * 0.04 - 0.02)).toFixed(2)
                        }));
                    } catch (err) {
                        console.log("Veri Ã§ekme hatasÄ± (CORS/Network):", err);
                    }
                };
                const intervalId = setInterval(fetchFuelData, 10 * 60 * 1000); 
                return () => clearInterval(intervalId);
            }, []);

            useEffect(() => {
                if (selectedChatUser && messagesEndRef.current) {
                    messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });
                }
            }, [myMessages, selectedChatUser]);

            const loadPosts = async () => {
                const allPosts = await api.posts.getAll();
                const active = allPosts.filter(p => p.status === 'active' && !isPostExpired(p.createdAt));
                setPosts(active);

                const favs = await api.favorites.getMy(currentUser.id);
                setMyFavs(favs);

                const msgs = await api.messages.getMyMessages(currentUser.id);
                setMyMessages(msgs);

                // --- NEW: Fetch My Reports ---
                const allReps = await api.reports.getAll();
                setMyReports(allReps.filter(r => r.reporterId === currentUser.id));

                const users = await api.users.getAll();
                const userMap = {};
                users.forEach(u => userMap[u.id] = u);
                setAllUsers(userMap);
            };

            const handleFav = async (e, post) => {
                e.stopPropagation();
                const added = await api.favorites.toggle(currentUser.id, post.id, 'post');
                if (added) {
                    setMyFavs([...myFavs, { id: generateId(), userId: currentUser.id, targetId: post.id, targetType: 'post' }]);
                    setToast({ msg: 'Favorilere eklendi', type: 'success' });
                } else {
                    setMyFavs(myFavs.filter(f => f.targetId !== post.id));
                    setToast({ msg: 'Favorilerden Ã§Ä±karÄ±ldÄ±', type: 'info' });
                }
            };

            const openMsgModal = (e, post) => {
                e.stopPropagation();
                if(post.userId === currentUser.id) {
                    alert("Kendi ilanÄ±nÄ±za mesaj atamazsÄ±nÄ±z.");
                    return;
                }
                setActivePost(post);
                setShowMsgModal(true);
            };

            const openReportModal = (e, post) => {
                e.stopPropagation();
                if(post.userId === currentUser.id) return;
                setActivePost(post);
                setShowReportModal(true);
            };

            const handleSendMsg = async () => {
                if(!msgText.trim() || !activePost) return;
                await api.messages.send({
                    id: generateId(),
                    senderId: currentUser.id,
                    receiverId: activePost.userId,
                    jobPostId: activePost.id,
                    message: msgText,
                    read: false,
                    createdAt: new Date().toISOString()
                });
                setShowMsgModal(false);
                setMsgText('');
                setToast({ msg: 'Mesaj gÃ¶nderildi', type: 'success' });
                // Refresh messages
                const msgs = await api.messages.getMyMessages(currentUser.id);
                setMyMessages(msgs);
            };
            
            const handleReport = async () => {
                if(!activePost) return;
                await api.reports.create({
                    id: generateId(),
                    reporterId: currentUser.id,
                    targetType: 'post',
                    targetId: activePost.id,
                    ...reportData,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                });
                setShowReportModal(false);
                setToast({ msg: 'Åžikayetiniz iletildi', type: 'info' });
                // Update local reports list
                setMyReports(prev => [...prev, {
                    id: generateId(),
                    reporterId: currentUser.id,
                    targetType: 'post',
                    targetId: activePost.id,
                    ...reportData,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                }]);
            };

            // --- NEW: Delete Message Handler ---
            const handleMessageDelete = async (id) => {
                if(confirm("Bu mesajÄ± silmek istediÄŸinize emin misiniz?")) {
                    await api.messages.delete(id);
                    setMyMessages(prev => prev.filter(m => m.id !== id));
                    setToast({ msg: 'Mesaj silindi', type: 'info' });
                }
            };

            // --- NEW: Chat Handling Logic ---
            const handleChatSend = async () => {
                if (!chatInput.trim() || !selectedChatUser) return;
                
                await api.messages.send({
                    id: generateId(),
                    senderId: currentUser.id,
                    receiverId: selectedChatUser.id,
                    jobPostId: 'direct', // Generic placeholder for direct chat
                    message: chatInput,
                    read: false,
                    createdAt: new Date().toISOString()
                });

                setChatInput('');
                // Real-time update simulation
                const msgs = await api.messages.getMyMessages(currentUser.id);
                setMyMessages(msgs);
            };

            // Group messages by user for the contact list
            const conversations = useMemo(() => {
                const convs = {};
                myMessages.forEach(msg => {
                    const otherUserId = msg.senderId === currentUser.id ? msg.receiverId : msg.senderId;
                    if (!convs[otherUserId]) {
                        convs[otherUserId] = {
                            user: allUsers[otherUserId] || { id: otherUserId, name: 'Bilinmeyen', surname: 'KullanÄ±cÄ±' },
                            lastMessage: msg,
                            count: 0
                        };
                    }
                    // Update if this message is newer
                    if (new Date(msg.createdAt) > new Date(convs[otherUserId].lastMessage.createdAt)) {
                        convs[otherUserId].lastMessage = msg;
                    }
                    convs[otherUserId].count++;
                });
                return Object.values(convs).sort((a, b) => new Date(b.lastMessage.createdAt) - new Date(a.lastMessage.createdAt));
            }, [myMessages, allUsers, currentUser]);

            // Get messages for active chat
            const activeChatMessages = useMemo(() => {
                if (!selectedChatUser) return [];
                return myMessages.filter(m => 
                    (m.senderId === currentUser.id && m.receiverId === selectedChatUser.id) ||
                    (m.senderId === selectedChatUser.id && m.receiverId === currentUser.id)
                ).sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
            }, [myMessages, selectedChatUser, currentUser]);

            // Enhanced Filtering and Sorting Logic
            const filteredPosts = useMemo(() => {
                let filtered = posts.filter(p => {
                    const matchesCategory = filter.category === 'all' || p.category === filter.category;
                    const postCity = p.location?.address || '';
                    const matchesCity = !searchCity || postCity.includes(searchCity);
                    const matchesVehicle = !searchVehicle || (p.vehicleType === searchVehicle);
                    return matchesCategory && matchesCity && matchesVehicle;
                });

                return filtered.sort((a, b) => {
                    if (a.isSponsored && !b.isSponsored) return -1;
                    if (!a.isSponsored && b.isSponsored) return 1;
                    if (searchCity) {
                        const aLoc = a.location?.address || '';
                        const bLoc = b.location?.address || '';
                        const aMatch = aLoc.includes(searchCity);
                        const bMatch = bLoc.includes(searchCity);
                        if (aMatch && !bMatch) return -1;
                        if (!aMatch && bMatch) return 1;
                    }
                    return new Date(b.createdAt) - new Date(a.createdAt);
                });
            }, [posts, filter, searchCity, searchVehicle]);

            const inboxMessages = myMessages.filter(m => m.receiverId === currentUser.id);

            return (
                <div className="p-4 pb-24 space-y-4">
                    {toast && <Toast {...toast} onClose={() => setToast(null)} />}

                    {/* Fuel Prices Widget */}
                    <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 relative overflow-hidden">
                         <div className="flex justify-between items-center text-sm relative z-10">
                            <div className="text-center flex-1">
                                <span className="block text-gray-400 text-xs mb-1">Benzin</span>
                                <span className="font-bold text-gray-800 text-lg">{fuelPrices.benzin} â‚º</span>
                            </div>
                            <div className="h-8 w-px bg-gray-200"></div>
                            <div className="text-center flex-1">
                                <span className="block text-gray-400 text-xs mb-1">Motorin</span>
                                <span className="font-bold text-gray-800 text-lg">{fuelPrices.motorin} â‚º</span>
                            </div>
                            <div className="h-8 w-px bg-gray-200"></div>
                            <div className="text-center flex-1">
                                <span className="block text-gray-400 text-xs mb-1">LPG</span>
                                <span className="font-bold text-gray-800 text-lg">{fuelPrices.lpg} â‚º</span>
                            </div>
                        </div>
                        <div className="mt-2 text-center">
                            <span className="text-[10px] text-green-600 bg-green-50 px-2 py-0.5 rounded-full border border-green-100 flex items-center justify-center gap-1 w-fit mx-auto">
                                <Icon name="wifi" size={10}/> CanlÄ± Veri
                            </span>
                        </div>
                    </div>

                    {/* Messages Notification Area */}
                    <button 
                        onClick={() => setShowInboxModal(true)}
                        className="w-full bg-white p-3 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between hover:bg-gray-50 transition group"
                    >
                        <div className="flex items-center gap-3">
                            <div className="bg-brand/10 p-2 rounded-full text-brand group-hover:bg-brand group-hover:text-white transition">
                                <Icon name="message-circle" size={20} />
                            </div>
                            <div className="text-left">
                                <span className="block font-bold text-gray-800 text-sm">MesajlarÄ±m</span>
                                <span className="text-xs text-gray-500">{inboxMessages.length} Yeni Mesaj</span>
                            </div>
                        </div>
                        <Icon name="chevron-right" className="text-gray-400" size={18} />
                    </button>

                    {/* Search / Filter Bar */}
                    <div className="grid grid-cols-2 gap-2">
                        <select 
                            value={searchCity} 
                            onChange={(e)=>setSearchCity(e.target.value)} 
                            className="w-full px-4 py-3 rounded-xl border border-gray-200 shadow-sm focus:border-brand focus:ring-2 focus:ring-brand/20 outline-none transition-all bg-white appearance-none"
                            style={{backgroundImage: 'none'}}
                        >
                            <option value="">Konum</option>
                            {Object.keys(TURKEY_DATA).map(city => (
                                <option key={city} value={city}>{city}</option>
                            ))}
                        </select>
                        <select 
                            value={searchVehicle} 
                            onChange={(e)=>setSearchVehicle(e.target.value)} 
                            className="w-full px-4 py-3 rounded-xl border border-gray-200 shadow-sm focus:border-brand focus:ring-2 focus:ring-brand/20 outline-none transition-all bg-white appearance-none"
                            style={{backgroundImage: 'none'}}
                        >
                            <option value="">TÃ¼m AraÃ§lar</option>
                            {VEHICLE_TYPES.map(t => (
                                <option key={t} value={t}>{t}</option>
                            ))}
                        </select>
                    </div>

                    {/* Filters */}
                    <div className="flex gap-2 overflow-x-auto pb-2 no-scrollbar">
                        <button onClick={() => setFilter({category: 'all'})} className={`px-4 py-2 rounded-full text-sm whitespace-nowrap ${filter.category === 'all' ? 'bg-brand text-white' : 'bg-white text-gray-600 border'}`}>TÃ¼mÃ¼</button>
                        <button onClick={() => setFilter({category: 'surucu-ariyorum'})} className={`px-4 py-2 rounded-full text-sm whitespace-nowrap ${filter.category === 'surucu-ariyorum' ? 'bg-brand text-white' : 'bg-white text-gray-600 border'}`}>ðŸ‘¨â€âœˆï¸ SÃ¼rÃ¼cÃ¼</button>
                        <button onClick={() => setFilter({category: 'is-ariyorum'})} className={`px-4 py-2 rounded-full text-sm whitespace-nowrap ${filter.category === 'is-ariyorum' ? 'bg-brand text-white' : 'bg-white text-gray-600 border'}`}>ðŸ’¼ Ä°ÅŸ</button>
                        <button onClick={() => setFilter({category: 'arac-ariyorum'})} className={`px-4 py-2 rounded-full text-sm whitespace-nowrap ${filter.category === 'arac-ariyorum' ? 'bg-brand text-white' : 'bg-white text-gray-600 border'}`}>ðŸš— AraÃ§</button>
                    </div>

                    {/* Post List */}
                    <div className="space-y-4">
                        {filteredPosts.map(post => {
                            const isFav = myFavs.some(f => f.targetId === post.id);
                            return (
                                <div key={post.id} onClick={() => onItemClick(post)} className={`bg-white p-4 rounded-xl shadow-sm border cursor-pointer relative hover:shadow-md transition ${post.isSponsored ? 'border-yellow-400 bg-yellow-50/30 ring-1 ring-yellow-400' : 'border-gray-100'}`}>
                                    {post.isSponsored && (
                                        <div className="absolute -top-2 -right-2 bg-gradient-to-r from-gold to-gold-dark text-white text-xs font-bold px-2 py-1 rounded-full shadow-sm flex items-center gap-1 z-10">
                                            <Icon name="star" size={10} /> Ã–ne Ã‡Ä±kan
                                        </div>
                                    )}
                                    <div className="flex justify-between items-start mb-2">
                                        <div className="flex gap-2 items-center">
                                            <span className="text-2xl p-2 bg-gray-50 rounded-lg">
                                                {post.category === 'surucu-ariyorum' ? 'ðŸ‘¨â€âœˆï¸' : post.category === 'is-ariyorum' ? 'ðŸ’¼' : 'ðŸš—'}
                                            </span>
                                            <div>
                                                <h3 className="font-bold text-gray-800 line-clamp-1">{post.title}</h3>
                                                <p className="text-xs text-gray-500">{post.accountType === 'company' ? post.companyName : 'Bireysel'} â€¢ {post.location.address}</p>
                                            </div>
                                        </div>
                                        {post.salary && <span className="bg-green-100 text-green-700 text-xs font-bold px-2 py-1 rounded">{post.salary} â‚º</span>}
                                    </div>
                                    
                                    {/* Display Vehicle Info if available */}
                                    {post.vehicleType && (
                                        <div className="mb-3 text-xs text-blue-800 bg-blue-50 border border-blue-100 px-2 py-1.5 rounded-md flex items-center gap-2 font-medium">
                                            <Icon name="truck" size={12} />
                                            {post.vehicleType} 
                                            {post.vehicleModel && ` â€¢ ${post.vehicleModel}`}
                                            {post.vehicleYear && ` â€¢ ${post.vehicleYear}`}
                                        </div>
                                    )}

                                    <p className="text-gray-600 text-sm line-clamp-2 mb-3">{post.description}</p>
                                    
                                    <div className="flex justify-between items-center text-xs text-gray-400 border-t pt-2 mt-2">
                                        <div className="flex gap-2 items-center">
                                            <span>{formatDate(post.createdAt)}</span>
                                            <span className="flex items-center gap-1"><Icon name="eye" size={12} /> {post.views || 0}</span>
                                        </div>
                                        
                                        <div className="flex gap-1">
                                            <button 
                                                onClick={(e) => handleFav(e, post)} 
                                                className={`p-2 rounded-full hover:bg-red-50 transition ${isFav ? 'text-red-500' : 'text-gray-400'}`}
                                                title={isFav ? "Favorilerden Ã‡Ä±kar" : "Favorilere Ekle"}
                                            >
                                                <Icon name="heart" size={16} className={isFav ? "fill-current" : ""} />
                                            </button>
                                            {currentUser.id !== post.userId && (
                                                <>
                                                    <button 
                                                        onClick={(e) => openMsgModal(e, post)}
                                                        className="p-2 rounded-full hover:bg-blue-50 text-gray-400 hover:text-brand transition"
                                                        title="Mesaj GÃ¶nder"
                                                    >
                                                        <Icon name="message-circle" size={16} />
                                                    </button>
                                                    <button 
                                                        onClick={(e) => openReportModal(e, post)}
                                                        className="p-2 rounded-full hover:bg-red-50 text-gray-400 hover:text-red-500 transition"
                                                        title="Åžikayet Et"
                                                    >
                                                        <Icon name="flag" size={16} />
                                                    </button>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                        {filteredPosts.length === 0 && (
                            <div className="text-center py-10 text-gray-400">
                                <Icon name="search" size={40} className="mx-auto mb-2 opacity-20" />
                                <p>Bu kategoride henÃ¼z ilan yok.</p>
                            </div>
                        )}
                    </div>

                    {/* NEW: WHATSAPP STYLE INBOX MODAL */}
                    <Modal isOpen={showInboxModal} onClose={() => { setShowInboxModal(false); setSelectedChatUser(null); }} title="Ä°letiÅŸim Merkezi" maxWidth="max-w-2xl">
                        <div className="flex flex-col h-[70vh]">
                            
                            {/* Tab Navigation */}
                            {!selectedChatUser && (
                                <div className="flex border-b border-gray-200 mb-2">
                                    <button 
                                        className={`flex-1 py-3 font-bold text-sm transition ${inboxTab === 'messages' ? 'text-brand border-b-2 border-brand bg-brand/5' : 'text-gray-500 hover:bg-gray-50'}`}
                                        onClick={() => setInboxTab('messages')}
                                    >
                                        <div className="flex items-center justify-center gap-2">
                                            <Icon name="message-circle" size={16}/> Mesajlar
                                        </div>
                                    </button>
                                    <button 
                                        className={`flex-1 py-3 font-bold text-sm transition ${inboxTab === 'reports' ? 'text-brand border-b-2 border-brand bg-brand/5' : 'text-gray-500 hover:bg-gray-50'}`}
                                        onClick={() => setInboxTab('reports')}
                                    >
                                        <div className="flex items-center justify-center gap-2">
                                            <Icon name="alert-circle" size={16}/> Åžikayetlerim
                                        </div>
                                    </button>
                                </div>
                            )}

                            {/* Content Area */}
                            <div className="flex-1 overflow-hidden relative">
                                
                                {/* Reports Tab */}
                                {inboxTab === 'reports' && !selectedChatUser && (
                                    <div className="h-full overflow-y-auto p-2 space-y-3">
                                        {myReports.length === 0 ? (
                                            <div className="flex flex-col items-center justify-center h-full text-gray-400">
                                                <Icon name="check-circle" size={48} className="mb-2 opacity-20" />
                                                <p className="text-sm">HenÃ¼z bir ÅŸikayet bildiriminiz yok.</p>
                                            </div>
                                        ) : (
                                            myReports.map(rep => (
                                                <div key={rep.id} className="bg-white p-3 rounded-lg border border-gray-100 shadow-sm">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <span className="text-xs font-bold uppercase bg-gray-100 text-gray-600 px-2 py-0.5 rounded">{rep.reason}</span>
                                                        {rep.status === 'pending' ? (
                                                            <span className="text-[10px] bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded-full flex items-center gap-1">
                                                                <span className="w-1.5 h-1.5 bg-yellow-500 rounded-full"></span> Beklemede
                                                            </span>
                                                        ) : (
                                                            <span className="text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded-full flex items-center gap-1">
                                                                <span className="w-1.5 h-1.5 bg-green-500 rounded-full"></span> Ã‡Ã¶zÃ¼ldÃ¼
                                                            </span>
                                                        )}
                                                    </div>
                                                    <p className="text-sm text-gray-600 italic line-clamp-2">"{rep.description}"</p>
                                                    <div className="mt-2 text-[10px] text-gray-400 text-right border-t pt-1">
                                                        {formatDate(rep.createdAt)}
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                )}

                                {/* Messages Tab (Contact List) */}
                                {inboxTab === 'messages' && !selectedChatUser && (
                                    <div className="h-full overflow-y-auto p-2 space-y-2">
                                        {conversations.length === 0 ? (
                                            <div className="flex flex-col items-center justify-center h-full text-gray-400">
                                                <Icon name="inbox" size={48} className="mb-2 opacity-20" />
                                                <p className="text-sm">HenÃ¼z bir mesajlaÅŸma baÅŸlatmadÄ±nÄ±z.</p>
                                            </div>
                                        ) : (
                                            conversations.map(conv => (
                                                <div 
                                                    key={conv.user.id} 
                                                    onClick={() => setSelectedChatUser(conv.user)}
                                                    className="bg-white p-3 rounded-xl border border-gray-100 hover:border-brand hover:shadow-md transition cursor-pointer flex items-center gap-3"
                                                >
                                                    <div className="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center text-xl overflow-hidden flex-shrink-0">
                                                        {conv.user.profileImage ? <img src={conv.user.profileImage} className="w-full h-full object-cover"/> : 'ðŸ‘¤'}
                                                    </div>
                                                    <div className="flex-1 min-w-0">
                                                        <div className="flex justify-between items-center mb-1">
                                                            <h4 className="font-bold text-sm truncate text-gray-800">{conv.user.name} {conv.user.surname}</h4>
                                                            <span className="text-[10px] text-gray-400 whitespace-nowrap ml-2">{formatDate(conv.lastMessage.createdAt)}</span>
                                                        </div>
                                                        <p className="text-xs text-gray-500 truncate">{conv.lastMessage.message}</p>
                                                    </div>
                                                    <Icon name="chevron-right" size={16} className="text-gray-300" />
                                                </div>
                                            ))
                                        )}
                                    </div>
                                )}

                                {/* ACTIVE CHAT WINDOW (WhatsApp Style) */}
                                {selectedChatUser && (
                                    <div className="absolute inset-0 bg-gray-50 flex flex-col z-20 animate-fade-in">
                                        {/* Chat Header */}
                                        <div className="bg-white border-b p-3 flex items-center gap-3 shadow-sm">
                                            <button onClick={() => setSelectedChatUser(null)} className="text-gray-500 hover:bg-gray-100 p-2 rounded-full">
                                                <Icon name="arrow-left" size={20} />
                                            </button>
                                            <div 
                                                className="flex items-center gap-3 flex-1 cursor-pointer hover:opacity-80 transition"
                                                onClick={() => {
                                                    setShowInboxModal(false);
                                                    onViewProfile(selectedChatUser.id);
                                                }}
                                            >
                                                <div className="w-10 h-10 bg-gray-200 rounded-full overflow-hidden flex-shrink-0">
                                                    {selectedChatUser.profileImage ? <img src={selectedChatUser.profileImage} className="w-full h-full object-cover"/> : <div className="w-full h-full flex items-center justify-center">ðŸ‘¤</div>}
                                                </div>
                                                <div>
                                                    <h3 className="font-bold text-sm text-gray-800">{selectedChatUser.name} {selectedChatUser.surname}</h3>
                                                    <span className="text-[10px] text-green-500 flex items-center gap-1">
                                                        <span className="w-1.5 h-1.5 bg-green-500 rounded-full"></span> Ã‡evrimiÃ§i
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Chat Messages Area */}
                                        <div className="flex-1 overflow-y-auto p-4 space-y-3 chat-area">
                                            {activeChatMessages.map(msg => {
                                                const isMe = msg.senderId === currentUser.id;
                                                return (
                                                    <div key={msg.id} className={`flex ${isMe ? 'justify-end' : 'justify-start'} group`}>
                                                        <div className={`max-w-[80%] rounded-lg p-2 shadow-sm relative text-sm ${isMe ? 'bg-chat-sent text-gray-800 rounded-tr-none' : 'bg-white text-gray-800 rounded-tl-none'}`}>
                                                            {!isMe && <div className="text-[10px] font-bold text-orange-500 mb-0.5">{selectedChatUser.name}</div>}
                                                            <p className="leading-relaxed whitespace-pre-wrap break-words">{msg.message}</p>
                                                            <div className="flex justify-end items-center gap-1 mt-1">
                                                                <span className="text-[9px] text-gray-400">{new Date(msg.createdAt).toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'})}</span>
                                                                {isMe && <Icon name="check" size={10} className="text-blue-500" />}
                                                            </div>
                                                            
                                                            {/* Delete Action */}
                                                            <button 
                                                                onClick={() => handleMessageDelete(msg.id)}
                                                                className={`absolute top-0 ${isMe ? '-left-8' : '-right-8'} p-1.5 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition`}
                                                                title="Sil"
                                                            >
                                                                <Icon name="trash-2" size={14} />
                                                            </button>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                            <div ref={messagesEndRef} />
                                        </div>

                                        {/* Input Area */}
                                        <div className="bg-white border-t p-3">
                                            <div className="flex items-center gap-2">
                                                <input 
                                                    type="text" 
                                                    className="flex-1 bg-gray-100 border-0 rounded-full px-4 py-3 text-sm focus:ring-2 focus:ring-brand/50 focus:outline-none focus:bg-white transition"
                                                    placeholder="Bir mesaj yazÄ±n..."
                                                    value={chatInput}
                                                    onChange={e => setChatInput(e.target.value)}
                                                    onKeyDown={e => e.key === 'Enter' && handleChatSend()}
                                                />
                                                <button 
                                                    onClick={handleChatSend}
                                                    disabled={!chatInput.trim()}
                                                    className="bg-brand text-white p-3 rounded-full hover:bg-brand-dark transition disabled:opacity-50 disabled:cursor-not-allowed shadow-sm"
                                                >
                                                    <Icon name="send" size={18} />
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </Modal>

                    {/* Feed Modals */}
                    <Modal isOpen={showMsgModal} onClose={() => setShowMsgModal(false)} title="Mesaj GÃ¶nder">
                        <div className="space-y-4">
                            <p className="text-sm text-gray-600">
                                <strong>{activePost?.title}</strong> ilanÄ± iÃ§in mesajÄ±nÄ±z:
                            </p>
                            <textarea className="w-full border p-2 rounded h-32" placeholder="MesajÄ±nÄ±z..." value={msgText} onChange={e => setMsgText(e.target.value)}></textarea>
                            <button onClick={handleSendMsg} className="w-full bg-brand text-white py-2 rounded">GÃ¶nder</button>
                        </div>
                    </Modal>

                    <Modal isOpen={showReportModal} onClose={() => setShowReportModal(false)} title="Ä°lanÄ± Åžikayet Et">
                        <div className="space-y-4">
                            <p className="text-sm text-gray-600">
                                <strong>{activePost?.title}</strong> ilanÄ±nÄ± neden ÅŸikayet ediyorsunuz?
                            </p>
                            <select className="w-full border p-2 rounded" value={reportData.reason} onChange={e => setReportData({...reportData, reason: e.target.value})}>
                                <option value="spam">Spam / Reklam</option>
                                <option value="fake">Sahte Bilgi</option>
                                <option value="scam">DolandÄ±rÄ±cÄ±lÄ±k</option>
                                <option value="inappropriate">Uygunsuz Ä°Ã§erik</option>
                            </select>
                            <textarea className="w-full border p-2 rounded h-24" placeholder="AÃ§Ä±klama..." value={reportData.description} onChange={e => setReportData({...reportData, description: e.target.value})} required></textarea>
                            <button onClick={handleReport} className="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600">GÃ¶nder</button>
                        </div>
                    </Modal>
                </div>
            );
        };

        // Post Creator
        const CreatePost = ({ currentUser, onComplete, editPost = null }) => {
            const [form, setForm] = useState(editPost || {
                category: 'surucu-ariyorum',
                accountType: 'individual',
                title: '',
                description: '',
                vehicleType: '',
                vehicleModel: '',
                vehicleYear: '',
                salary: '',
                contactInfo: currentUser.phone || currentUser.email,
                companyName: '',
                location: { address: '', lat: 0, lng: 0 }
            });

            // Separate states for City/District selection
            const [selectedCity, setSelectedCity] = useState('');
            const [selectedDistrict, setSelectedDistrict] = useState('');

            // Separate states for Brand/Model selection
            const [selectedBrand, setSelectedBrand] = useState('');
            const [selectedModel, setSelectedModel] = useState('');

            // Populate city/district and brand/model if editing
            useEffect(() => {
                if (editPost) {
                    // Location logic
                    if (editPost.location && editPost.location.address) {
                        const parts = editPost.location.address.split(' / ');
                        if (parts.length === 2) {
                            const [d, c] = parts;
                            if (TURKEY_DATA[c]) {
                                setSelectedCity(c);
                                setSelectedDistrict(d);
                            }
                        }
                    }
                    // Vehicle Logic
                    if (editPost.vehicleModel) {
                        const vParts = editPost.vehicleModel.split(' - ');
                        if (vParts.length === 2 && VEHICLE_BRANDS[vParts[0]]) {
                            setSelectedBrand(vParts[0]);
                            setSelectedModel(vParts[1]);
                        }
                    }
                }
            }, [editPost]);

            // ... existing handlers (handleCityChange, handleDistrictChange) ...
            const handleCityChange = (e) => {
                const city = e.target.value;
                setSelectedCity(city);
                setSelectedDistrict(''); 
                setForm(prev => ({
                    ...prev,
                    location: { ...prev.location, address: city ? `${city}` : '' } 
                }));
            };

            const handleDistrictChange = (e) => {
                const district = e.target.value;
                setSelectedDistrict(district);
                if (selectedCity && district) {
                    setForm(prev => ({
                        ...prev,
                        location: { ...prev.location, address: `${district} / ${selectedCity}` }
                    }));
                }
            };

            // New Handlers for Vehicle
            const handleBrandChange = (e) => {
                const brand = e.target.value;
                setSelectedBrand(brand);
                setSelectedModel('');
                setForm(prev => ({ ...prev, vehicleModel: brand })); // Temporary, finalized with model
            };

            const handleModelChange = (e) => {
                const model = e.target.value;
                setSelectedModel(model);
                if (selectedBrand && model) {
                    setForm(prev => ({ ...prev, vehicleModel: `${selectedBrand} - ${model}` }));
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                
                // Validate City/District
                if (!selectedCity || !selectedDistrict) {
                    alert('LÃ¼tfen Ä°l ve Ä°lÃ§e seÃ§imi yapÄ±nÄ±z.');
                    return;
                }

                // Validate Vehicle info if vehicle type is selected
                if (form.vehicleType && (!selectedBrand || !selectedModel || !form.vehicleYear)) {
                     alert('LÃ¼tfen araÃ§ markasÄ±nÄ±, modelini ve yÄ±lÄ±nÄ± seÃ§iniz.');
                     return;
                }

                const postData = {
                    ...form,
                    id: editPost ? editPost.id : generateId(),
                    userId: currentUser.id,
                    updatedAt: editPost ? new Date().toISOString() : null,
                    createdAt: editPost ? editPost.createdAt : new Date().toISOString(),
                    status: 'active',
                    isSponsored: editPost ? editPost.isSponsored : false,
                    views: editPost ? editPost.views : 0
                };

                if (editPost) await api.posts.update(postData);
                else await api.posts.create(postData);
                
                onComplete();
            };

            // Generate years for dropdown
            const years = [];
            for(let i = 2025; i >= 2005; i--) {
                years.push(i);
            }

            return (
                <div className="p-4 pb-24 bg-white min-h-screen">
                    <h2 className="text-xl font-bold mb-6">{editPost ? 'Ä°lanÄ± DÃ¼zenle' : 'Yeni Ä°lan OluÅŸtur'}</h2>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        
                        {/* ... existing Account Type & Category selection ... */}
                        <div>
                            <label className="block text-sm font-bold mb-1">Hesap Tipi</label>
                            <div className="flex gap-4">
                                <label className="flex items-center gap-2 border p-3 rounded-lg flex-1 cursor-pointer has-[:checked]:border-brand has-[:checked]:bg-brand/5">
                                    <input type="radio" name="accType" checked={form.accountType === 'individual'} onChange={() => setForm({...form, accountType: 'individual'})} />
                                    Bireysel
                                </label>
                                <label className="flex items-center gap-2 border p-3 rounded-lg flex-1 cursor-pointer has-[:checked]:border-brand has-[:checked]:bg-brand/5">
                                    <input type="radio" name="accType" checked={form.accountType === 'company'} onChange={() => setForm({...form, accountType: 'company'})} />
                                    Firma
                                </label>
                            </div>
                        </div>

                        {form.accountType === 'company' && (
                            <input type="text" placeholder="Firma AdÄ± (Zorunlu)" required className="w-full border p-3 rounded-lg" value={form.companyName} onChange={e => setForm({...form, companyName: e.target.value})} />
                        )}

                        <select className="w-full border p-3 rounded-lg" value={form.category} onChange={e => setForm({...form, category: e.target.value})}>
                            <option value="surucu-ariyorum">ðŸ‘¨â€âœˆï¸ SÃ¼rÃ¼cÃ¼ ArÄ±yorum</option>
                            <option value="is-ariyorum">ðŸ’¼ Ä°ÅŸ ArÄ±yorum</option>
                            <option value="arac-ariyorum">ðŸš— AraÃ§ ArÄ±yorum</option>
                        </select>

                        <input type="text" placeholder="Ä°lan BaÅŸlÄ±ÄŸÄ± (Max 100)" maxLength={100} required className="w-full border p-3 rounded-lg" value={form.title} onChange={e => setForm({...form, title: e.target.value})} />
                        
                        <textarea placeholder="AÃ§Ä±klama (Max 1000)" maxLength={1000} required className="w-full border p-3 rounded-lg h-32" value={form.description} onChange={e => setForm({...form, description: e.target.value})}></textarea>
                        
                        {/* --- NEW: Commercial Vehicle Selection Panel --- */}
                        <div className="p-4 bg-gray-50 rounded-xl border border-gray-100 space-y-3">
                            <div className="flex items-center gap-2 text-sm font-bold text-gray-700 mb-1">
                                <Icon name="truck" size={16} /> AraÃ§ Bilgileri
                            </div>
                            
                            <div>
                                <select 
                                    className="w-full border p-3 rounded-lg bg-white"
                                    value={form.vehicleType}
                                    onChange={e => setForm({...form, vehicleType: e.target.value})}
                                >
                                    <option value="">AraÃ§ Tipi SeÃ§iniz (Opsiyonel)</option>
                                    {VEHICLE_TYPES.map(t => <option key={t} value={t}>{t}</option>)}
                                </select>
                            </div>

                            {/* Only show Brand/Model if Type is selected */}
                            {form.vehicleType && (
                                <div className="space-y-3 animate-fade-in">
                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1 ml-1">Marka</label>
                                            <select 
                                                className="w-full border p-3 rounded-lg bg-white"
                                                value={selectedBrand}
                                                onChange={handleBrandChange}
                                            >
                                                <option value="">SeÃ§iniz</option>
                                                {Object.keys(VEHICLE_BRANDS).map(brand => (
                                                    <option key={brand} value={brand}>{brand}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-gray-500 mb-1 ml-1">Model</label>
                                            <select 
                                                className="w-full border p-3 rounded-lg bg-white disabled:bg-gray-100 disabled:text-gray-400"
                                                value={selectedModel}
                                                onChange={handleModelChange}
                                                disabled={!selectedBrand}
                                            >
                                                <option value="">{selectedBrand ? 'SeÃ§iniz' : 'Ã–nce Marka'}</option>
                                                {selectedBrand && VEHICLE_BRANDS[selectedBrand].map(model => (
                                                    <option key={model} value={model}>{model}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-gray-500 mb-1 ml-1">Model YÄ±lÄ±</label>
                                        <select 
                                            className="w-full border p-3 rounded-lg bg-white"
                                            value={form.vehicleYear}
                                            onChange={e => setForm({...form, vehicleYear: e.target.value})}
                                        >
                                            <option value="">YÄ±l SeÃ§iniz</option>
                                            {years.map(year => (
                                                <option key={year} value={year}>{year}</option>
                                            ))}
                                        </select>
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <input type="text" placeholder="Ãœcret (Opsiyonel)" className="w-full border p-3 rounded-lg" value={form.salary} onChange={e => setForm({...form, salary: e.target.value})} />
                            <input type="text" placeholder="Ä°letiÅŸim (Zorunlu)" required className="w-full border p-3 rounded-lg" value={form.contactInfo} onChange={e => setForm({...form, contactInfo: e.target.value})} />
                        </div>

                        {/* --- New Location Selection UI --- */}
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-xs font-bold text-gray-500 mb-1 ml-1">Ä°l</label>
                                <select 
                                    className="w-full border p-3 rounded-lg" 
                                    value={selectedCity} 
                                    onChange={handleCityChange}
                                    required
                                >
                                    <option value="">SeÃ§iniz</option>
                                    {Object.keys(TURKEY_DATA).map(city => (
                                        <option key={city} value={city}>{city}</option>
                                    ))}
                                </select>
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-gray-500 mb-1 ml-1">Ä°lÃ§e</label>
                                <select 
                                    className="w-full border p-3 rounded-lg disabled:bg-gray-100 disabled:text-gray-400" 
                                    value={selectedDistrict} 
                                    onChange={handleDistrictChange}
                                    disabled={!selectedCity}
                                    required
                                >
                                    <option value="">{selectedCity ? 'SeÃ§iniz' : 'Ã–nce Ä°l SeÃ§in'}</option>
                                    {selectedCity && TURKEY_DATA[selectedCity].map(dist => (
                                        <option key={dist} value={dist}>{dist}</option>
                                    ))}
                                </select>
                            </div>
                        </div>

                        <button className="w-full bg-brand text-white py-4 rounded-xl font-bold shadow-lg hover:bg-brand-dark transition">
                            {editPost ? 'DeÄŸiÅŸiklikleri Kaydet' : 'Ä°lanÄ± YayÄ±nla'}
                        </button>
                    </form>
                </div>
            );
        };

        // Profile & My Posts
        const Profile = ({ currentUser, onLogout, onUpdateUser }) => {
            const [activeTab, setActiveTab] = useState('info');
            const [myPosts, setMyPosts] = useState([]);
            const [favPosts, setFavPosts] = useState([]);
            const [isEditing, setIsEditing] = useState(false);
            const [editForm, setEditForm] = useState({...currentUser});
            
            // SÄ°LME Ä°ÅžLEMÄ° Ä°Ã‡Ä°N YENÄ° STATE'LER
            const [showDeleteModal, setShowDeleteModal] = useState(false);
            const [postToDelete, setPostToDelete] = useState(null);

            // ÅžÄ°FRE DEÄžÄ°ÅžTÄ°RME STATE'LERÄ°
            const [showPasswordModal, setShowPasswordModal] = useState(false);
            const [passForm, setPassForm] = useState({ current: '', new: '', confirm: '' });

            const fileInputRef = useRef(null);
            
            useEffect(() => {
                const load = async () => {
                    // Load My Posts
                    const all = await api.posts.getAll();
                    setMyPosts(all.filter(p => p.userId === currentUser.id));

                    // Load Favorite Posts
                    const myFavs = await api.favorites.getMy(currentUser.id);
                    const favPostIds = myFavs.filter(f => f.targetType === 'post').map(f => f.targetId);
                    setFavPosts(all.filter(p => favPostIds.includes(p.id)));
                };
                load();
                setEditForm({...currentUser});
            }, [currentUser]);

            // ESKÄ° DELETE YERÄ°NE YENÄ° FONKSÄ°YONLAR
            const handleDeleteClick = (id) => {
                setPostToDelete(id);
                setShowDeleteModal(true);
            };

            const confirmDelete = async () => {
                if(postToDelete) {
                    await api.posts.delete(postToDelete);
                    setMyPosts(myPosts.filter(p => p.id !== postToDelete));
                    setShowDeleteModal(false);
                    setPostToDelete(null);
                }
            };

            // ÅžÄ°FRE GÃœNCELLEME FONKSÄ°YONU
            const handlePasswordUpdate = async (e) => {
                e.preventDefault();
                
                if (passForm.current !== currentUser.password) {
                    alert("Mevcut ÅŸifreniz hatalÄ±. LÃ¼tfen kontrol ediniz.");
                    return;
                }

                if (passForm.new.length < 6) {
                    alert("Yeni ÅŸifreniz en az 6 karakter olmalÄ±dÄ±r.");
                    return;
                }

                if (passForm.new !== passForm.confirm) {
                    alert("Yeni ÅŸifreler birbiriyle uyuÅŸmuyor.");
                    return;
                }

                try {
                    const updatedUser = { ...currentUser, password: passForm.new };
                    await api.users.update(updatedUser);
                    if (onUpdateUser) onUpdateUser(updatedUser);
                    
                    setShowPasswordModal(false);
                    setPassForm({ current: '', new: '', confirm: '' });
                    alert("Åžifreniz baÅŸarÄ±yla gÃ¼ncellendi.");
                } catch (error) {
                    console.error("Åžifre gÃ¼ncellenemedi:", error);
                    alert("Bir hata oluÅŸtu.");
                }
            };

            // 90 Day Logic
            const canChangeName = () => {
                if(!currentUser.lastNameChange) return true;
                const lastChange = new Date(currentUser.lastNameChange);
                const now = new Date();
                const diffTime = Math.abs(now - lastChange);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays >= 90;
            };
            
            const daysRemaining = () => {
                if(!currentUser.lastNameChange) return 0;
                const lastChange = new Date(currentUser.lastNameChange);
                const now = new Date();
                const diffTime = Math.abs(now - lastChange);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return 90 - diffDays;
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if(file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setEditForm({...editForm, profileImage: reader.result});
                    };
                    reader.readAsDataURL(file);
                }
            };

            const saveProfile = async () => {
                // Check name change rule
                let updatedUser = {...editForm};
                const nameChanged = editForm.name !== currentUser.name || editForm.surname !== currentUser.surname;
                
                if (nameChanged) {
                    if (!canChangeName()) {
                        alert(`Ä°sim deÄŸiÅŸikliÄŸi iÃ§in ${daysRemaining()} gÃ¼n daha beklemelisiniz.`);
                        return;
                    }
                    updatedUser.lastNameChange = new Date().toISOString();
                }

                await api.users.update(updatedUser);
                // Update global user state via prop
                if (onUpdateUser) onUpdateUser(updatedUser);
                setIsEditing(false);
                alert('Profil gÃ¼ncellendi.');
            };

            return (
                <div className="bg-gray-50 min-h-screen pb-24">
                    {/* Header & Profile Image */}
                    <div className="bg-white p-6 mb-4 shadow-sm relative">
                        <div className="flex items-center gap-4">
                            <div className="relative group">
                                <div className="w-20 h-20 bg-gray-200 rounded-full overflow-hidden border-2 border-gray-100">
                                    {editForm.profileImage ? <img src={editForm.profileImage} className="w-full h-full object-cover"/> : <div className="w-full h-full flex items-center justify-center text-3xl">ðŸ‘¤</div>}
                                </div>
                                {isEditing && (
                                    <button onClick={() => fileInputRef.current.click()} className="absolute inset-0 bg-black/30 flex items-center justify-center text-white rounded-full opacity-0 group-hover:opacity-100 transition">
                                        <Icon name="camera" size={20} />
                                    </button>
                                )}
                                <input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={handleImageUpload} />
                            </div>
                            
                            <div className="flex-1">
                                <h2 className="text-xl font-bold">{currentUser.name} {currentUser.surname}</h2>
                                <p className="text-gray-500 text-sm">{currentUser.email}</p>
                                <div className="flex gap-2 mt-2">
                                    {currentUser.isSponsored && <span className="bg-yellow-100 text-yellow-700 text-xs px-2 py-0.5 rounded">VIP</span>}
                                    <span className="bg-gray-100 text-gray-600 text-xs px-2 py-0.5 rounded">Ãœye</span>
                                </div>
                            </div>
                            
                            {!isEditing && (
                                <button onClick={() => setIsEditing(true)} className="text-brand font-bold text-sm bg-brand/5 px-3 py-1 rounded-full">DÃ¼zenle</button>
                            )}
                        </div>
                    </div>

                    {/* Tabs */}
                    <div className="flex bg-white border-b mb-4">
                        <button onClick={() => setActiveTab('info')} className={`flex-1 py-3 font-medium text-sm border-b-2 ${activeTab === 'info' ? 'border-brand text-brand' : 'border-transparent'}`}>Bilgilerim</button>
                        <button onClick={() => setActiveTab('posts')} className={`flex-1 py-3 font-medium text-sm border-b-2 ${activeTab === 'posts' ? 'border-brand text-brand' : 'border-transparent'}`}>Ä°lanlarÄ±m</button>
                        <button onClick={() => setActiveTab('favs')} className={`flex-1 py-3 font-medium text-sm border-b-2 ${activeTab === 'favs' ? 'border-brand text-brand' : 'border-transparent'}`}>Favorilerim</button>
                    </div>

                    <div className="p-4">
                        {/* INFO TAB */}
                        {activeTab === 'info' && (
                            <div className="space-y-4 animate-fade-in">
                                {isEditing ? (
                                    <div className="space-y-4">
                                        <div className="bg-yellow-50 p-3 rounded text-xs text-yellow-700">
                                            <Icon name="alert-circle" size={12} className="inline mr-1"/>
                                            Ad ve Soyad deÄŸiÅŸikliÄŸi 90 gÃ¼nde bir yapÄ±labilir.
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-xs font-bold mb-1">Ad</label>
                                                <input type="text" disabled={!canChangeName()} className="w-full border p-2 rounded disabled:bg-gray-100 disabled:text-gray-400" value={editForm.name} onChange={e => setEditForm({...editForm, name: e.target.value})} />
                                            </div>
                                            <div>
                                                <label className="block text-xs font-bold mb-1">Soyad</label>
                                                <input type="text" disabled={!canChangeName()} className="w-full border p-2 rounded disabled:bg-gray-100 disabled:text-gray-400" value={editForm.surname} onChange={e => setEditForm({...editForm, surname: e.target.value})} />
                                            </div>
                                        </div>
                                        {!canChangeName() && <p className="text-xs text-red-500">Ä°sim deÄŸiÅŸtirmek iÃ§in {daysRemaining()} gÃ¼n beklemelisiniz.</p>}

                                        <div>
                                            <label className="block text-xs font-bold mb-1">HakkÄ±nda</label>
                                            <textarea className="w-full border p-2 rounded h-24" value={editForm.about || ''} onChange={e => setEditForm({...editForm, about: e.target.value})} placeholder="Kendinizden bahsedin..."></textarea>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-xs font-bold mb-1">Telefon / Ä°letiÅŸim</label>
                                            <input type="text" className="w-full border p-2 rounded" value={editForm.phone || ''} onChange={e => setEditForm({...editForm, phone: e.target.value})} placeholder="0555..." />
                                        </div>

                                        {/* NEW: Professional Info Edit */}
                                        <div className="border-t pt-4 mt-4">
                                            <h4 className="font-bold text-sm mb-3 text-gray-700">Profesyonel Bilgiler</h4>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-xs font-bold mb-1">AraÃ§ Tipi</label>
                                                    <select className="w-full border p-2 rounded" value={editForm.vehicleType || ''} onChange={e => setEditForm({...editForm, vehicleType: e.target.value})}>
                                                        <option value="">SeÃ§iniz</option>
                                                        {VEHICLE_TYPES.map(t => <option key={t} value={t}>{t}</option>)}
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="block text-xs font-bold mb-1">Koltuk SayÄ±sÄ±</label>
                                                    <select className="w-full border p-2 rounded" value={editForm.vehicleSeats || ''} onChange={e => setEditForm({...editForm, vehicleSeats: e.target.value})}>
                                                        <option value="">SeÃ§iniz</option>
                                                        <option value="9-16">9-16</option>
                                                        <option value="17-31">17-31</option>
                                                        <option value="32+">32+</option>
                                                        <option value="45+">45+</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="block text-xs font-bold mb-1">Ehliyet SÄ±nÄ±fÄ±</label>
                                                    <select className="w-full border p-2 rounded" value={editForm.licenseClass || ''} onChange={e => setEditForm({...editForm, licenseClass: e.target.value})}>
                                                        <option value="">SeÃ§iniz</option>
                                                        <option value="B">B</option>
                                                        <option value="C">C</option>
                                                        <option value="D">D</option>
                                                        <option value="E">E</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="pt-4 border-t mt-2">
                                            <button 
                                                type="button" 
                                                onClick={() => setShowPasswordModal(true)}
                                                className="w-full bg-gray-700 text-white py-2 rounded font-bold hover:bg-gray-800 transition flex items-center justify-center gap-2 mb-3"
                                            >
                                                <Icon name="lock" size={16} /> Åžifre DeÄŸiÅŸtir
                                            </button>
                                        </div>

                                        <div className="flex gap-3 pt-2">
                                            <button onClick={saveProfile} className="flex-1 bg-brand text-white py-2 rounded font-bold">Kaydet</button>
                                            <button onClick={() => { setIsEditing(false); setEditForm({...currentUser}); }} className="flex-1 bg-gray-200 text-gray-700 py-2 rounded font-bold">Ä°ptal</button>
                                        </div>
                                    </div>
                                ) : (
                                    <>
                                        <div className="bg-white p-4 rounded-xl shadow-sm">
                                            <h3 className="font-bold mb-2 text-gray-800">HakkÄ±nda</h3>
                                            <p className="text-gray-600 text-sm leading-relaxed">{currentUser.about || 'HenÃ¼z bilgi girilmedi.'}</p>
                                        </div>
                                        
                                        {/* NEW: Professional Info View */}
                                        {(currentUser.vehicleType || currentUser.licenseClass || currentUser.vehicleSeats) && (
                                            <div className="bg-white p-4 rounded-xl shadow-sm mt-4">
                                                <h3 className="font-bold mb-2 text-gray-800">Profesyonel Bilgiler</h3>
                                                <div className="grid grid-cols-3 gap-2 text-center">
                                                    {currentUser.vehicleType && (
                                                        <div className="bg-gray-50 p-2 rounded border border-gray-100">
                                                            <div className="text-xs text-gray-400 mb-1">AraÃ§</div>
                                                            <div className="font-bold text-sm text-gray-800">{currentUser.vehicleType}</div>
                                                        </div>
                                                    )}
                                                    {currentUser.vehicleSeats && (
                                                        <div className="bg-gray-50 p-2 rounded border border-gray-100">
                                                            <div className="text-xs text-gray-400 mb-1">Koltuk</div>
                                                            <div className="font-bold text-sm text-gray-800">{currentUser.vehicleSeats}</div>
                                                        </div>
                                                    )}
                                                    {currentUser.licenseClass && (
                                                        <div className="bg-gray-50 p-2 rounded border border-gray-100">
                                                            <div className="text-xs text-gray-400 mb-1">Ehliyet</div>
                                                            <div className="font-bold text-sm text-gray-800">{currentUser.licenseClass}</div>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        )}

                                        <div className="bg-white p-4 rounded-xl shadow-sm">
                                            <h3 className="font-bold mb-2 text-gray-800">Ä°letiÅŸim</h3>
                                            <div className="flex items-center gap-2 text-sm text-gray-600">
                                                <Icon name="phone" size={16} /> {currentUser.phone || 'Belirtilmedi'}
                                            </div>
                                            <div className="flex items-center gap-2 text-sm text-gray-600 mt-2">
                                                <Icon name="mail" size={16} /> {currentUser.email}
                                            </div>
                                        </div>
                                        <button onClick={onLogout} className="w-full bg-red-50 text-red-600 py-3 rounded-lg font-medium hover:bg-red-100 transition">Ã‡Ä±kÄ±ÅŸ Yap</button>
                                    </>
                                )}
                            </div>
                        )}

                        {/* MY POSTS TAB */}
                        {activeTab === 'posts' && (
                            <div className="space-y-3 animate-fade-in">
                                {myPosts.map(post => (
                                    <div key={post.id} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <h4 className="font-bold text-gray-800">{post.title}</h4>
                                                <span className={`text-xs px-2 py-0.5 rounded ${post.status === 'active' ? 'bg-green-100 text-green-700' : 'bg-gray-100'}`}>{post.status}</span>
                                                {isPostExpired(post.createdAt) && <span className="ml-2 text-xs bg-red-100 text-red-600 px-2 py-0.5 rounded">SÃ¼resi Doldu</span>}
                                            </div>
                                            <div className="flex gap-2">
                                                {/* SÄ°LME BUTONUNDA DEÄžÄ°ÅžÄ°KLÄ°K */}
                                                <button onClick={() => handleDeleteClick(post.id)} className="p-2 text-red-500 bg-red-50 rounded hover:bg-red-100"><Icon name="trash" size={16} /></button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                                {myPosts.length === 0 && <div className="text-center text-gray-400 mt-4">Ä°lanÄ±nÄ±z bulunmuyor.</div>}
                            </div>
                        )}

                        {/* FAVORITES TAB */}
                        {activeTab === 'favs' && (
                            <div className="space-y-3 animate-fade-in">
                                {favPosts.map(post => (
                                    <div key={post.id} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center">
                                        <div className="flex-1">
                                            <h4 className="font-bold text-gray-800 line-clamp-1">{post.title}</h4>
                                            <p className="text-xs text-gray-500">{post.location.address}</p>
                                            <span className="text-xs text-brand bg-brand/5 px-2 py-0.5 rounded mt-1 inline-block">{post.category}</span>
                                        </div>
                                        <button className="bg-brand text-white px-4 py-2 rounded-lg text-sm font-bold" onClick={() => {}}>
                                            Ä°ncele
                                        </button>
                                    </div>
                                ))}
                                {favPosts.length === 0 && <div className="text-center text-gray-400 mt-10 flex flex-col items-center">
                                    <Icon name="heart" size={30} className="mb-2 opacity-20"/>
                                    <p>Favori ilanÄ±nÄ±z yok.</p>
                                </div>}
                            </div>
                        )}
                    </div>

                    {/* YENÄ° SÄ°LME ONAY MODALI */}
                    <Modal isOpen={showDeleteModal} onClose={() => setShowDeleteModal(false)} title="Ä°lanÄ± Sil">
                        <div className="space-y-4">
                            <p className="text-sm text-gray-600">Bu ilanÄ± kalÄ±cÄ± olarak silmek istediÄŸinize emin misiniz? Bu iÅŸlem geri alÄ±namaz.</p>
                            <div className="flex gap-3">
                                <button onClick={confirmDelete} className="flex-1 bg-red-500 text-white py-2 rounded font-bold hover:bg-red-600 transition">Evet, Sil</button>
                                <button onClick={() => setShowDeleteModal(false)} className="flex-1 bg-gray-200 text-gray-800 py-2 rounded font-bold hover:bg-gray-300 transition">Ä°ptal</button>
                            </div>
                        </div>
                    </Modal>

                    {/* ÅžÄ°FRE DEÄžÄ°ÅžTÄ°RME MODALI */}
                    <Modal isOpen={showPasswordModal} onClose={() => setShowPasswordModal(false)} title="Åžifre DeÄŸiÅŸtir">
                        <form onSubmit={handlePasswordUpdate} className="space-y-4">
                            <div>
                                <label className="block text-xs font-bold text-gray-500 mb-1">Mevcut Åžifre</label>
                                <input 
                                    type="password" 
                                    required 
                                    className="w-full border p-3 rounded-lg bg-gray-50 focus:bg-white transition focus:ring-2 focus:ring-brand focus:outline-none"
                                    value={passForm.current}
                                    onChange={e => setPassForm({...passForm, current: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-gray-500 mb-1">Yeni Åžifre</label>
                                <input 
                                    type="password" 
                                    required 
                                    className="w-full border p-3 rounded-lg bg-gray-50 focus:bg-white transition focus:ring-2 focus:ring-brand focus:outline-none"
                                    value={passForm.new}
                                    onChange={e => setPassForm({...passForm, new: e.target.value})}
                                />
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-gray-500 mb-1">Yeni Åžifre (Tekrar)</label>
                                <input 
                                    type="password" 
                                    required 
                                    className="w-full border p-3 rounded-lg bg-gray-50 focus:bg-white transition focus:ring-2 focus:ring-brand focus:outline-none"
                                    value={passForm.confirm}
                                    onChange={e => setPassForm({...passForm, confirm: e.target.value})}
                                />
                            </div>
                            <button className="w-full bg-brand text-white py-3 rounded-xl font-bold hover:bg-brand-dark transition shadow-lg mt-2">
                                Åžifreyi GÃ¼ncelle
                            </button>
                        </form>
                    </Modal>
                </div>
            );
        };

        // ENHANCED Admin Panel
        const AdminPanel = ({ onBack }) => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [users, setUsers] = useState([]);
            const [posts, setPosts] = useState([]);
            const [reports, setReports] = useState([]);

            const loadData = async () => {
                const u = await api.users.getAll();
                const p = await api.posts.getAll();
                const r = await api.reports.getAll();
                setUsers(u);
                setPosts(p);
                setReports(r);
            };

            useEffect(() => {
                loadData();
            }, []);

            const resolveReport = async (id) => {
                const report = reports.find(r => r.id === id);
                if (report) {
                    report.status = 'resolved';
                    await api.reports.update(report);
                    loadData();
                }
            };

            // User Management Functions
            const toggleVip = async (user) => {
                user.isSponsored = !user.isSponsored;
                await api.users.update(user);
                loadData();
            };

            const deleteUser = async (id) => {
                if(confirm("Bu kullanÄ±cÄ±yÄ± ve tÃ¼m verilerini silmek istediÄŸinize emin misiniz?")) {
                    await api.users.delete(id);
                    // Optionally delete their posts too
                    loadData();
                }
            };

            // Post Management Functions
            const toggleSponsoredPost = async (post) => {
                post.isSponsored = !post.isSponsored;
                await api.posts.update(post);
                loadData();
            };

            const deletePost = async (id) => {
                if(confirm("Bu ilanÄ± silmek istediÄŸinize emin misiniz?")) {
                    await api.posts.delete(id);
                    loadData();
                }
            };

            return (
                <div className="bg-gray-100 min-h-screen pb-20 flex flex-col">
                    <div className="bg-gray-900 text-white p-6 shadow-md">
                        <div className="flex justify-between items-center">
                            <div>
                                <h1 className="text-2xl font-bold">Admin Paneli</h1>
                                <p className="opacity-70 text-sm">Sistem YÃ¶netimi</p>
                            </div>
                            <button onClick={onBack} className="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded text-sm font-bold">Ã‡Ä±kÄ±ÅŸ</button>
                        </div>
                    </div>

                    {/* Navigation Tabs */}
                    <div className="flex bg-white shadow-sm mb-4 overflow-x-auto">
                        <button onClick={() => setActiveTab('dashboard')} className={`flex-1 py-3 font-bold text-sm border-b-2 ${activeTab === 'dashboard' ? 'border-brand text-brand' : 'border-transparent text-gray-500'}`}>Ã–zet</button>
                        <button onClick={() => setActiveTab('users')} className={`flex-1 py-3 font-bold text-sm border-b-2 ${activeTab === 'users' ? 'border-brand text-brand' : 'border-transparent text-gray-500'}`}>KullanÄ±cÄ±lar</button>
                        <button onClick={() => setActiveTab('posts')} className={`flex-1 py-3 font-bold text-sm border-b-2 ${activeTab === 'posts' ? 'border-brand text-brand' : 'border-transparent text-gray-500'}`}>Ä°lanlar</button>
                        <button onClick={() => setActiveTab('reports')} className={`flex-1 py-3 font-bold text-sm border-b-2 ${activeTab === 'reports' ? 'border-brand text-brand' : 'border-transparent text-gray-500'}`}>Åžikayetler</button>
                    </div>

                    <div className="flex-1 overflow-y-auto p-4">
                        {/* DASHBOARD TAB */}
                        {activeTab === 'dashboard' && (
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 animate-fade-in">
                                <div className="bg-white p-6 rounded-lg shadow text-center">
                                    <div className="text-3xl font-bold text-brand">{users.length}</div>
                                    <div className="text-sm text-gray-500">Toplam KullanÄ±cÄ±</div>
                                </div>
                                <div className="bg-white p-6 rounded-lg shadow text-center">
                                    <div className="text-3xl font-bold text-blue-500">{posts.length}</div>
                                    <div className="text-sm text-gray-500">Toplam Ä°lan</div>
                                </div>
                                <div className="bg-white p-6 rounded-lg shadow text-center">
                                    <div className="text-3xl font-bold text-green-500">{posts.filter(p => p.isSponsored).length}</div>
                                    <div className="text-sm text-gray-500">Ã–ne Ã‡Ä±kan Ä°lan</div>
                                </div>
                                <div className="bg-white p-6 rounded-lg shadow text-center">
                                    <div className="text-3xl font-bold text-red-500">{reports.filter(r => r.status === 'pending').length}</div>
                                    <div className="text-sm text-gray-500">Bekleyen Åžikayet</div>
                                </div>
                            </div>
                        )}

                        {/* USERS TAB */}
                        {activeTab === 'users' && (
                            <div className="space-y-3 animate-fade-in">
                                {users.map(u => (
                                    <div key={u.id} className="bg-white p-4 rounded-lg shadow-sm flex items-center justify-between">
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-lg">
                                                {u.profileImage ? <img src={u.profileImage} className="w-full h-full rounded-full object-cover"/> : 'ðŸ‘¤'}
                                            </div>
                                            <div>
                                                <div className="font-bold text-sm">{u.name} {u.surname} {u.role === 'admin' && <span className="bg-black text-white text-[10px] px-1 rounded">ADMIN</span>}</div>
                                                <div className="text-xs text-gray-500">{u.email}</div>
                                            </div>
                                        </div>
                                        <div className="flex gap-2">
                                            {u.role !== 'admin' && (
                                                <>
                                                    <button onClick={() => toggleVip(u)} className={`px-3 py-1 rounded text-xs font-bold ${u.isSponsored ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-100 text-gray-600'}`}>
                                                        {u.isSponsored ? 'VIP Ä°ptal' : 'VIP Yap'}
                                                    </button>
                                                    <button onClick={() => deleteUser(u.id)} className="bg-red-50 text-red-500 p-2 rounded hover:bg-red-100">
                                                        <Icon name="trash" size={14} />
                                                    </button>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* POSTS TAB */}
                        {activeTab === 'posts' && (
                            <div className="space-y-3 animate-fade-in">
                                {posts.map(p => (
                                    <div key={p.id} className="bg-white p-4 rounded-lg shadow-sm">
                                        <div className="flex justify-between items-start mb-2">
                                            <h4 className="font-bold text-sm line-clamp-1">{p.title}</h4>
                                            <span className={`text-[10px] px-2 py-0.5 rounded ${p.status === 'active' ? 'bg-green-100 text-green-700' : 'bg-gray-100'}`}>{p.status}</span>
                                        </div>
                                        <div className="text-xs text-gray-500 mb-3">{p.location.address}</div>
                                        <div className="flex justify-end gap-2 border-t pt-2">
                                            <button onClick={() => toggleSponsoredPost(p)} className={`px-3 py-1 rounded text-xs font-bold flex items-center gap-1 ${p.isSponsored ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-100 text-gray-600'}`}>
                                                <Icon name="star" size={12} /> {p.isSponsored ? 'Ã–ne Ã‡Ä±karma' : 'Ã–ne Ã‡Ä±kar'}
                                            </button>
                                            <button onClick={() => deletePost(p.id)} className="bg-red-50 text-red-500 px-3 py-1 rounded text-xs font-bold hover:bg-red-100">
                                                Sil
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* REPORTS TAB */}
                        {activeTab === 'reports' && (
                            <div className="space-y-3 animate-fade-in">
                                {reports.filter(r => r.status === 'pending').map(r => (
                                    <div key={r.id} className="bg-white p-4 rounded-lg shadow-sm border-l-4 border-red-500">
                                        <div className="flex justify-between mb-2">
                                            <span className="bg-red-100 text-red-700 text-xs px-2 py-1 rounded uppercase font-bold">{r.reason}</span>
                                            <span className="text-xs text-gray-400">{formatDate(r.createdAt)}</span>
                                        </div>
                                        <p className="text-sm text-gray-700 mb-3">{r.description}</p>
                                        <button onClick={() => resolveReport(r.id)} className="w-full bg-green-100 text-green-700 py-2 rounded text-sm font-bold hover:bg-green-200">
                                            Ã‡Ã¶zÃ¼ldÃ¼ Ä°ÅŸaretle
                                        </button>
                                    </div>
                                ))}
                                {reports.filter(r => r.status === 'pending').length === 0 && <div className="text-center text-gray-400 py-10">Bekleyen ÅŸikayet yok ðŸŽ‰</div>}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- MAIN APP SHELL --- (LocalStorage DÃ¼zeltmesiyle GÃ¼ncel)
        const App = () => {
            // LocalStorage kullanÄ±larak oturumun kalÄ±cÄ± olmasÄ± saÄŸlanÄ±yor
            const [user, setUser] = useState(() => {
                const stored = localStorage.getItem('currentUser');
                return stored ? JSON.parse(stored) : null;
            });

            const [activeTab, setActiveTab] = useState('home'); 
            const [detailPost, setDetailPost] = useState(null);
            const [editingPost, setEditingPost] = useState(null);
            const [viewingUser, setViewingUser] = useState(null); 

            const handleLogin = (u) => {
                setUser(u);
                localStorage.setItem('currentUser', JSON.stringify(u));
            };

            const handleLogout = () => {
                setUser(null);
                localStorage.removeItem('currentUser');
                setActiveTab('home');
            };

            const handleUpdateUser = (updatedUser) => {
                setUser(updatedUser);
                localStorage.setItem('currentUser', JSON.stringify(updatedUser));
            };

            const navigateToDetail = (post) => {
                setDetailPost(post);
                setActiveTab('detail');
            };

            const handleEdit = (post) => {
                setEditingPost(post);
                setActiveTab('create');
            };

            const handleViewProfile = (userId) => {
                setViewingUser(userId);
                setActiveTab('public-profile');
            }

            if (!user) return <AuthPage onLogin={handleLogin} />;

            if (user.role === 'admin' && activeTab === 'admin') {
                return <AdminPanel onBack={() => setActiveTab('home')} />;
            }

            return (
                <div className="h-full flex flex-col bg-gray-50 max-w-2xl mx-auto shadow-2xl min-h-screen relative">
                    
                    {/* Content Area */}
                    <div className="flex-1 overflow-y-auto scroll-smooth">
                        {activeTab === 'home' && <Feed currentUser={user} onItemClick={navigateToDetail} onViewProfile={handleViewProfile} />}
                        {activeTab === 'create' && <CreatePost currentUser={user} editPost={editingPost} onComplete={() => { setEditingPost(null); setActiveTab('home'); }} />}
                        {activeTab === 'profile' && <Profile currentUser={user} onLogout={handleLogout} onUpdateUser={handleUpdateUser} />}
                        {activeTab === 'detail' && detailPost && <PostDetail post={detailPost} currentUser={user} onBack={() => setActiveTab('home')} onEdit={handleEdit} onViewProfile={handleViewProfile} />}
                        {activeTab === 'public-profile' && viewingUser && <PublicProfile userId={viewingUser} onBack={() => setActiveTab('home')} />}
                    </div>

                    {/* Bottom Navigation (only show if not in detail view) */}
                    {activeTab !== 'detail' && activeTab !== 'public-profile' && (
                        <div className="bg-white border-t px-6 py-2 flex justify-between items-center pb-safe sticky bottom-0 z-40">
                            <button onClick={() => setActiveTab('home')} className={`p-2 flex flex-col items-center gap-1 ${activeTab === 'home' ? 'text-brand' : 'text-gray-400'}`}>
                                <Icon name="home" />
                                <span className="text-[10px] font-bold">Ana Sayfa</span>
                            </button>
                            
                            <button onClick={() => { setEditingPost(null); setActiveTab('create'); }} className="bg-brand text-white p-4 rounded-full -mt-8 shadow-lg border-4 border-gray-50 hover:scale-105 transition">
                                <Icon name="plus" size={24} />
                            </button>

                            <button onClick={() => setActiveTab('profile')} className={`p-2 flex flex-col items-center gap-1 ${activeTab === 'profile' ? 'text-brand' : 'text-gray-400'}`}>
                                <Icon name="user" />
                                <span className="text-[10px] font-bold">Profilim</span>
                            </button>
                        </div>
                    )}
                    
                    {/* Admin Switcher */}
                    {user.role === 'admin' && activeTab !== 'admin' && (
                         <button onClick={() => setActiveTab('admin')} className="fixed bottom-24 left-4 bg-black text-white p-3 rounded-full shadow-lg text-xs z-50">
                            Admin Panel
                        </button>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
